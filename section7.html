<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Section VII — The Transformer Revolution · How AI Works</title>
<link rel="stylesheet" href="styles.css">
</head><body>
<div class="progress-bar" style="background:linear-gradient(90deg,var(--a6),var(--a8))"></div>
<button class="back-top" onclick="window.scrollTo({top:0,behavior:'smooth'})">↑</button>
<nav class="topnav"><a href="index.html" class="logo">How AI Works</a><div class="nav-links"><a href="section4.html">IV</a><a href="section5.html">V</a><a href="section6.html">VI</a><a href="section7.html" class="active">VII</a><a href="section8.html">VIII</a></div></nav>
<div class="section-hero" style="background:radial-gradient(ellipse 60% 50% at 50% 70%,rgba(56,189,248,.07),transparent)">
  <div class="era-label" style="color:var(--a6)">Section VII · 2016–2019</div>
  <h1>The Transformer Revolution</h1>
  <p>"Attention Is All You Need" — a single architecture unifies NLP, spawns BERT, GPT, and reshapes the entire landscape of AI.</p>
  <div class="nav-arrows"><a href="section6.html">&larr; Section VI</a><a href="section8.html">Section VIII &rarr;</a></div>
</div>
<div class="models-container">

<!-- XGBOOST -->
<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a6)">2016</span><div class="mc-info"><h3>XGBoost</h3><p>Chen & Guestrin's extreme gradient boosting — adds L1/L2 regularization to gradient boosting, plus clever engineering: column-block, cache-aware, and out-of-core computation. Dominated Kaggle competitions for years.</p></div></div>
<div class="mc-formula" style="color:var(--a6)">Obj = sum L(y_i, y_hat_i) + sum [gamma T + 0.5 lambda ||w||^2]    regularized GBDT</div>
<div class="mc-demo" id="demo-xgb"></div></div>

<!-- WAVENET -->
<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a6)">2016</span><div class="mc-info"><h3>WaveNet</h3><p>DeepMind's dilated causal convolutions for raw audio generation — each layer doubles its receptive field, so deep stacks capture long-range patterns without exploding parameters. Revolutionized text-to-speech quality.</p></div></div>
<div class="mc-formula" style="color:var(--a6)">dilation: 1, 2, 4, 8, 16, ...  receptive field grows exponentially with depth</div>
<div class="mc-demo" id="demo-wave"></div></div>

<!-- TRANSFORMER ⭐ -->
<div class="model-card" style="border-color:rgba(56,189,248,.2);box-shadow:0 0 40px rgba(56,189,248,.04)"><div class="mc-head"><span class="mc-year" style="color:var(--a6);border-color:rgba(56,189,248,.4);background:rgba(56,189,248,.08)">2017 ⭐</span><div class="mc-info"><h3>Transformer</h3><p>Vaswani et al.'s "Attention Is All You Need" — replace recurrence entirely with multi-head self-attention. Each token attends to every other token in parallel. Positional encodings provide sequence order. The architecture that launched modern AI.</p></div></div>
<div class="mc-formula" style="color:var(--a6)">Attention(Q,K,V) = softmax(QK^T / sqrt(d_k)) V    MultiHead = Concat(head_1,...,head_h) W^O</div>
<div class="mc-demo" id="demo-transformer"></div></div>

<!-- ELMO -->
<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a6)">2018</span><div class="mc-info"><h3>ELMo</h3><p>Peters et al.'s contextual word embeddings — the same word gets different vectors depending on context. "Bank" in "river bank" vs "bank account" produces distinct representations via bidirectional LSTMs.</p></div></div>
<div class="mc-formula" style="color:var(--a6)">ELMo_k = gamma sum s_j h_{k,j}^LM    (weighted sum of biLSTM layers, per token)</div>
<div class="mc-demo" id="demo-elmo"></div></div>

<!-- GPT-1 -->
<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a6)">2018</span><div class="mc-info"><h3>GPT-1</h3><p>OpenAI's Generative Pre-trained Transformer — pretrain a left-to-right Transformer on massive text, then fine-tune on downstream tasks. Showed that unsupervised pretraining + supervised fine-tuning is powerful.</p></div></div>
<div class="mc-formula" style="color:var(--a6)">P(token_t | token_1...token_{t-1}) via masked self-attention    pretrain -> fine-tune</div>
<div class="mc-demo" id="demo-gpt1"></div></div>

<!-- BERT -->
<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a6)">2018</span><div class="mc-info"><h3>BERT</h3><p>Devlin et al.'s bidirectional encoder — mask 15% of tokens, train the model to predict them using both left and right context. Unlike GPT's left-to-right approach, BERT sees the full sentence. Dominated NLU benchmarks.</p></div></div>
<div class="mc-formula" style="color:var(--a6)">Input: The [MASK] sat on the mat -> Predict: cat    (bidirectional attention)</div>
<div class="mc-demo" id="demo-bert"></div></div>

<!-- STYLEGAN -->
<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a6)">2018</span><div class="mc-info"><h3>StyleGAN</h3><p>Karras et al.'s style-based generator — a mapping network transforms the latent code z into style vectors w that control different levels of detail. Coarse styles (pose), medium (features), fine (color) are independently controllable.</p></div></div>
<div class="mc-formula" style="color:var(--a6)">z -> MappingNet -> w -> AdaIN at each layer    coarse / medium / fine style control</div>
<div class="mc-demo" id="demo-style"></div></div>

<!-- GPT-2 -->
<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a6)">2019</span><div class="mc-info"><h3>GPT-2</h3><p>Scaling up GPT to 1.5B parameters — "Language Models are Unsupervised Multitask Learners." GPT-2 showed that simply making models bigger on more data yields emergent few-shot abilities without fine-tuning.</p></div></div>
<div class="mc-formula" style="color:var(--a6)">Same architecture, 10x bigger: 117M -> 345M -> 762M -> 1.5B parameters</div>
<div class="mc-demo" id="demo-gpt2"></div></div>

<!-- T5 -->
<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a6)">2019</span><div class="mc-info"><h3>T5 (Text-to-Text Transfer Transformer)</h3><p>Raffel et al. at Google — reframe every NLP task as text-to-text: translation, summarization, QA, classification all become "input text -> output text." Unified architecture, unified training, unified interface.</p></div></div>
<div class="mc-formula" style="color:var(--a6)">"translate English to French: ..." -> "..."    "summarize: ..." -> "..."    everything is text</div>
<div class="mc-demo" id="demo-t5"></div></div>

</div>
<footer><a href="section6.html">&larr; Section VI</a> &middot; <a href="section8.html">Section VIII: Foundation Models &rarr;</a></footer>
<script src="shared.js"></script>
<script>
// ============ XGBOOST: Animated boosting rounds with regularization ============
(function(){
const el=$('demo-xgb'),[c,ctx]=createCanvas(el,750,260);
addHint(el,'Click "Boost" to add regularized trees -- watch residuals shrink and the fit improve');
let xs=Array(25).fill(0).map((_,i)=>i*28+20);let ys=xs.map(x=>Math.sin(x*.03)*100+130+rand(-12,12));
let trees=[],lr=.3,lambda=1;
function predict(x){return trees.reduce((a,t)=>a+lr*t.reduce((s,seg)=>s+(x>=seg.lo&&x<seg.hi?seg.val:0),0),0)}
function boost(){let residuals=xs.map((x,i)=>ys[i]-predict(x));
let segs=[];for(let s=0;s<720;s+=120){let vals=[];xs.forEach((x,i)=>{if(x>=s&&x<s+120)vals.push(residuals[i])});
let avg=vals.length?vals.reduce((a,b)=>a+b,0)/vals.length:0;
segs.push({lo:s,hi:s+120,val:avg/(1+lambda)})}
trees.push(segs);draw()}
function draw(){ctx.clearRect(0,0,750,260);
ctx.strokeStyle='#151520';for(let y=0;y<=260;y+=40){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(750,y);ctx.stroke()}
xs.forEach((x,i)=>{ctx.beginPath();ctx.arc(x,ys[i],4,0,TAU);ctx.fillStyle='#ffd166';ctx.fill()});
if(trees.length>0){ctx.strokeStyle='#38bdf8';ctx.lineWidth=2.5;ctx.beginPath();
for(let x=0;x<720;x+=2){let y=predict(x);x===0?ctx.moveTo(x,130-y+130):ctx.lineTo(x,130-y+130)}ctx.stroke();
xs.forEach((x,i)=>{let py=130-predict(x)+130;ctx.strokeStyle='rgba(255,107,107,.25)';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(x,ys[i]);ctx.lineTo(x,py);ctx.stroke()})}
let mse=trees.length?xs.reduce((a,x,i)=>a+(ys[i]-(130-predict(x)+130))**2,0)/xs.length:Infinity;
ctx.fillStyle='rgba(6,6,12,.88)';ctx.beginPath();ctx.roundRect(560,10,180,60,8);ctx.fill();
ctx.fillStyle='#38bdf8';ctx.font='600 10px Fira Code';ctx.fillText(`Round ${trees.length}`,572,28);
ctx.fillStyle='#ff6b6b';ctx.fillText(`MSE: ${mse<1e6?mse.toFixed(1):'\u221e'}`,572,44);
ctx.fillStyle='#a78bfa';ctx.fillText(`\u03bb=${lambda.toFixed(1)} (regularization)`,572,60)}
const ctrl=addControls(el);const btn=document.createElement('button');btn.className='btn';btn.textContent='\ud83c\udf32 Boost';btn.onclick=boost;
let timer=null;const abtn=document.createElement('button');abtn.className='btn';abtn.textContent='\u23e9 Auto';
abtn.onclick=()=>{if(timer){clearInterval(timer);timer=null;abtn.classList.remove('active')}else{timer=setInterval(()=>{boost();if(trees.length>=20){clearInterval(timer);timer=null;abtn.classList.remove('active')}},200);abtn.classList.add('active')}};
ctrl.innerHTML='<label>\u03bb</label><input type="range" min="0" max="50" value="10" id="xr"><span id="xrv" style="font-family:var(--mono);font-size:.7rem;color:var(--a4)">1.0</span>';
$('xr').oninput=e=>{lambda=e.target.value/10;$('xrv').textContent=lambda.toFixed(1)};
const rst=document.createElement('button');rst.className='btn';rst.textContent='\u21ba';rst.onclick=()=>{trees=[];if(timer){clearInterval(timer);timer=null;abtn.classList.remove('active')}draw()};
ctrl.appendChild(btn);ctrl.appendChild(abtn);ctrl.appendChild(rst);draw()})();

// ============ WAVENET: Dilated causal convolution animation ============
(function(){
const el=$('demo-wave'),[c,ctx]=createCanvas(el,750,280);
addHint(el,'Click "Generate" to see a waveform built sample by sample -- each layer\'s dilation doubles');
const dilations=[1,2,4,8,16];let signal=Array(64).fill(0),genPos=0,t=0;
function genSample(){if(genPos>=64)return;
let v=0;dilations.forEach((d,l)=>{let idx=genPos-d;if(idx>=0)v+=signal[idx]*(.4-l*.06)*Math.sin(l+genPos*.2)});
signal[genPos]=Math.tanh(v+Math.sin(genPos*.25)*.3);genPos++;draw()}
function draw(){t+=.02;ctx.clearRect(0,0,750,280);
let layerH=38,oy=10;
dilations.forEach((d,l)=>{let y=oy+l*layerH;
ctx.fillStyle='#7d7a8c';ctx.font='400 9px Fira Code';ctx.fillText(`dilation=${d}`,8,y+20);ctx.fillText(`receptive: ${2**l}`,8,y+32);
for(let i=0;i<64;i++){let x=85+i*10,active=i<=genPos&&(i%d===genPos%d||i===genPos);
ctx.beginPath();ctx.arc(x,y+18,3,0,TAU);ctx.fillStyle=active?`rgba(56,189,248,${.3+l*.15})`:'#151520';ctx.fill();
if(active&&i<genPos&&genPos-i<=d*2){ctx.strokeStyle='rgba(56,189,248,.2)';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(x,y+18);
let tx=85+Math.min(i+d,genPos)*10;ctx.lineTo(tx,y+18-layerH+18);ctx.stroke()}}});
// Output waveform
let wy=oy+dilations.length*layerH+10;
ctx.fillStyle='#ffd166';ctx.font='600 10px Fira Code';ctx.fillText('Generated Waveform:',85,wy);
ctx.strokeStyle='#4ecdc4';ctx.lineWidth=2;ctx.beginPath();
for(let i=0;i<64;i++){let x=85+i*10,y=wy+50+signal[i]*35;i?ctx.lineTo(x,y):ctx.moveTo(x,y)}ctx.stroke();
for(let i=0;i<genPos;i++){ctx.beginPath();ctx.arc(85+i*10,wy+50+signal[i]*35,2,0,TAU);ctx.fillStyle='#4ecdc4';ctx.fill()}
if(genPos<64){ctx.save();ctx.shadowColor='#ffd166';ctx.shadowBlur=10;ctx.beginPath();ctx.arc(85+genPos*10,wy+50,4,0,TAU);ctx.fillStyle='#ffd166';ctx.fill();ctx.restore()}
ctx.fillStyle='#7d7a8c';ctx.font='400 9px Fira Code';ctx.fillText(`${genPos}/64 samples`,85,wy+100)}
const ctrl=addControls(el);const btn=document.createElement('button');btn.className='btn';btn.textContent='\u25b6 Step';btn.onclick=genSample;
let timer=null;const abtn=document.createElement('button');abtn.className='btn';abtn.textContent='\u23e9 Generate';
abtn.onclick=()=>{if(timer){clearInterval(timer);timer=null;abtn.classList.remove('active')}else{timer=setInterval(()=>{genSample();if(genPos>=64){clearInterval(timer);timer=null;abtn.classList.remove('active')}},60);abtn.classList.add('active')}};
const rst=document.createElement('button');rst.className='btn';rst.textContent='\u21ba';rst.onclick=()=>{signal=Array(64).fill(0);genPos=0;if(timer){clearInterval(timer);timer=null;abtn.classList.remove('active')}draw()};
ctrl.appendChild(btn);ctrl.appendChild(abtn);ctrl.appendChild(rst);draw()})();

// ============ TRANSFORMER ⭐: Interactive multi-head self-attention ============
(function(){
const el=$('demo-transformer'),[c,ctx]=createCanvas(el,750,420);
addHint(el,'\u2b50 Click any word to see its attention pattern -- toggle between heads -- watch Q\u00b7K scores light up!');
const tokens=['The','cat','sat','on','the','warm','mat','today'];
const N=tokens.length;let selToken=2,curHead=0,nHeads=4,t=0;
let attnMats=[];for(let h=0;h<nHeads;h++){let m=[];for(let i=0;i<N;i++){let row=[];for(let j=0;j<N;j++){
let v=Math.random()*.2;if(h===0){if(Math.abs(i-j)<=1)v+=rand(.3,.6);if(j===0)v+=.15}
if(h===1){if(j<i)v+=rand(.1,.4)*(1-Math.abs(i-j)/N)}
if(h===2){let nouns=[1,6];if(nouns.includes(j))v+=rand(.3,.5);if(i===j)v+=.2}
if(h===3){if(j<=i&&(j===0||j===i))v+=rand(.3,.6)}
row.push(v)}
let s=row.reduce((a,b)=>a+Math.exp(b),0);m.push(row.map(v=>Math.exp(v)/s))}attnMats.push(m)}
const headNames=['Local Window','Causal Past','Noun Tracker','Boundary Focus'];
const headColors=['#ff6b6b','#4ecdc4','#ffd166','#a78bfa'];
function draw(){t+=.015;ctx.clearRect(0,0,750,420);
// Token row
let ox=55,tw=82,ty=30;
tokens.forEach((tk,i)=>{let x=ox+i*tw,active=i===selToken;
ctx.save();if(active){ctx.shadowColor='#38bdf8';ctx.shadowBlur=16}
ctx.beginPath();ctx.roundRect(x,ty,tw-6,34,8);
ctx.fillStyle=active?'rgba(56,189,248,.18)':'rgba(56,189,248,.04)';ctx.fill();
ctx.strokeStyle=active?'#38bdf8':'#38bdf833';ctx.lineWidth=active?2:1;ctx.stroke();ctx.restore();
ctx.fillStyle=active?'#fff':'#7d7a8c';ctx.font=`${active?'600 ':'400 '}12px Fira Code`;ctx.textAlign='center';ctx.fillText(tk,x+tw/2-3,ty+21)});
// Head selector
let hx=10,hy=80;ctx.fillStyle='#7d7a8c';ctx.font='500 9px Fira Code';ctx.textAlign='left';ctx.fillText('Attention Heads:',hx,hy);
headNames.forEach((h,i)=>{let y=hy+5+i*22,active=i===curHead;
ctx.fillStyle=active?headColors[i]+'33':'transparent';ctx.beginPath();ctx.roundRect(hx,y,130,18,4);ctx.fill();
ctx.strokeStyle=active?headColors[i]:headColors[i]+'33';ctx.lineWidth=1;ctx.beginPath();ctx.roundRect(hx,y,130,18,4);ctx.stroke();
ctx.fillStyle=active?headColors[i]:'#4a475a';ctx.font=`${active?'600':'400'} 8px Fira Code`;ctx.fillText(`H${i+1}: ${h}`,hx+6,y+12)});
// Attention heatmap
let mx=160,my=80,cs=36;
ctx.fillStyle='#38bdf8';ctx.font='600 9px Fira Code';ctx.textAlign='center';
tokens.forEach((tk,i)=>{ctx.fillText(tk,mx+i*cs+cs/2,my-4)});
let mat=attnMats[curHead];
mat.forEach((row,i)=>{
ctx.fillStyle='#38bdf844';ctx.font='400 8px Fira Code';ctx.textAlign='right';ctx.fillText(tokens[i],mx-6,my+i*cs+cs/2+3);ctx.textAlign='center';
row.forEach((v,j)=>{let x=mx+j*cs,y=my+i*cs;
let isActive=i===selToken;
ctx.fillStyle=isActive?`rgba(56,189,248,${v})`:`rgba(56,189,248,${v*.5})`;
ctx.fillRect(x+1,y+1,cs-2,cs-2);
if(v>.15){ctx.fillStyle=v>.4?'#000':'rgba(255,255,255,.6)';ctx.font='500 8px Fira Code';ctx.fillText((v*100|0)+'',x+cs/2,y+cs/2+3)}})});
// Active row highlight
ctx.strokeStyle='#38bdf8';ctx.lineWidth=2;ctx.strokeRect(mx,my+selToken*cs,N*cs,cs);
// Attention flow visualization (below heatmap)
let fy=my+N*cs+20;
ctx.fillStyle=headColors[curHead];ctx.font='600 10px Fira Code';ctx.textAlign='left';
ctx.fillText(`"${tokens[selToken]}" attends to:`,55,fy);
let row=mat[selToken];
tokens.forEach((tk,j)=>{let x=ox+j*tw,barH=row[j]*65;
ctx.fillStyle=`rgba(56,189,248,${.1+row[j]*.7})`;ctx.fillRect(x,fy+8+65-barH,tw-6,barH);
ctx.strokeStyle='#38bdf833';ctx.lineWidth=1;ctx.strokeRect(x,fy+8,tw-6,65);
if(row[j]>.1){ctx.fillStyle='#e4e2df';ctx.font='500 9px Fira Code';ctx.textAlign='center';ctx.fillText((row[j]*100|0)+'%',x+tw/2-3,fy+8+65-barH-5)}});
ctx.textAlign='left';
// Q K V explanation
ctx.fillStyle='rgba(6,6,12,.88)';ctx.beginPath();ctx.roundRect(55,fy+80,640,38,8);ctx.fill();
ctx.fillStyle='#ffd166';ctx.font='500 10px Fira Code';
ctx.fillText(`score(i,j) = Q_i \u00b7 K_j / \u221a${64}    \u2192    softmax    \u2192    weighted sum of V_j`,65,fy+103);
requestAnimationFrame(draw)}
c.onclick=e=>{let r=c.getBoundingClientRect(),mx2=(e.clientX-r.left)*750/r.width,my2=(e.clientY-r.top)*420/r.height;
// Click tokens
tokens.forEach((tk,i)=>{let x=55+i*82;if(mx2>=x&&mx2<=x+76&&my2>=30&&my2<=64)selToken=i});
// Click heads
headNames.forEach((_,i)=>{let y=85+i*22;if(mx2>=10&&mx2<=140&&my2>=y&&my2<=y+18)curHead=i})};
draw()})();

// ============ ELMO: Same word, different contexts ============
(function(){
const el=$('demo-elmo'),[c,ctx]=createCanvas(el,750,240);
addHint(el,'Click a word pair to see how ELMo produces different embeddings for the same word in different contexts');
const pairs=[
  {word:'bank',s1:'I sat by the river bank',s2:'She went to the bank for a loan',dims1:[.8,.2,.9,.1,.7,.3],dims2:[.1,.9,.2,.8,.3,.7]},
  {word:'bat',s1:'The bat flew out of the cave',s2:'He swung the bat at the ball',dims1:[.9,.1,.7,.2,.8,.3],dims2:[.2,.8,.3,.9,.1,.7]},
  {word:'play',s1:'The children play in the park',s2:'We went to see a play downtown',dims1:[.7,.3,.8,.2,.6,.5],dims2:[.3,.8,.2,.7,.5,.4]},
];
let sel=0;
function draw(){ctx.clearRect(0,0,750,240);let p=pairs[sel];
ctx.fillStyle='#ffd166';ctx.font='700 14px Fira Code';ctx.textAlign='center';ctx.fillText(`"${p.word}"`,375,25);
// Sentence 1
let lx=30,rx=400;
ctx.fillStyle='#38bdf8';ctx.font='500 10px Fira Code';ctx.textAlign='left';ctx.fillText('Context A:',lx,52);
ctx.fillStyle='#e4e2df';ctx.font='400 11px DM Sans';ctx.fillText(p.s1,lx,70);
ctx.fillStyle='#ff6b6b';ctx.font='500 10px Fira Code';ctx.fillText('Context B:',rx,52);
ctx.fillStyle='#e4e2df';ctx.font='400 11px DM Sans';ctx.fillText(p.s2,rx,70);
// Embedding bars
let by=90,bh=15,bw=140,gap=22;
ctx.fillStyle='#7d7a8c';ctx.font='400 8px Fira Code';
for(let d=0;d<6;d++){let y=by+d*gap;
ctx.fillStyle='#4a475a';ctx.textAlign='right';ctx.fillText(`dim ${d+1}`,lx+40,y+11);
ctx.fillStyle='#111120';ctx.fillRect(lx+50,y,bw,bh);ctx.fillRect(rx+50,y,bw,bh);
ctx.fillStyle='#38bdf888';ctx.fillRect(lx+50,y,bw*p.dims1[d],bh);
ctx.fillStyle='#ff6b6b88';ctx.fillRect(rx+50,y,bw*p.dims2[d],bh);
// Difference indicator
let diff=Math.abs(p.dims1[d]-p.dims2[d]);
ctx.fillStyle=diff>.4?'#ffd166':diff>.2?'#fb923c':'#34d399';
ctx.textAlign='left';ctx.fillText(diff>.4?'\u2716 different':diff>.2?'\u25cb partial':'\u2248 similar',rx+200,y+11)}
let cosim=p.dims1.reduce((a,v,i)=>a+v*p.dims2[i],0)/(Math.sqrt(p.dims1.reduce((a,v)=>a+v*v,0))*Math.sqrt(p.dims2.reduce((a,v)=>a+v*v,0)));
ctx.fillStyle='rgba(6,6,12,.85)';ctx.beginPath();ctx.roundRect(200,by+6*gap+5,350,30,8);ctx.fill();
ctx.textAlign='center';ctx.fillStyle='#ffd166';ctx.font='600 11px Fira Code';
ctx.fillText(`Cosine similarity: ${cosim.toFixed(3)} -- same word, different meaning!`,375,by+6*gap+24);ctx.textAlign='left'}
const ctrl=addControls(el);
pairs.forEach((p,i)=>{let b=document.createElement('button');b.className='btn'+(i===0?' active':'');b.textContent=`"${p.word}"`;
b.onclick=()=>{sel=i;ctrl.querySelectorAll('.btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');draw()};ctrl.appendChild(b)});
draw()})();

// ============ GPT-1: Autoregressive generation ============
(function(){
const el=$('demo-gpt1'),[c,ctx]=createCanvas(el,750,220);
addHint(el,'Click "Generate" to watch GPT predict one token at a time, left-to-right, never peeking ahead');
const vocab=['the','cat','sat','on','a','warm','soft','mat','and','then','it','purred','loudly','with','great','joy','in','sunlight'];
let sequence=['The','cat'],genPos=2;
function genNext(){if(genPos>=12)return;
let hash=0;sequence.forEach((w,i)=>{for(let j=0;j<w.length;j++)hash+=w.charCodeAt(j)*(i+1)});
sequence.push(vocab[(hash*13+genPos*7)%vocab.length]);genPos++;draw()}
function draw(){ctx.clearRect(0,0,750,220);
ctx.fillStyle='#38bdf8';ctx.font='600 10px Fira Code';ctx.fillText('Autoregressive generation (left-to-right):',20,22);
// Causal mask visualization
let ox=20,oy=40,tw=56;
sequence.forEach((w,i)=>{let x=ox+i*tw;
ctx.beginPath();ctx.roundRect(x,oy,tw-4,30,6);
let isNew=i===genPos-1;
ctx.fillStyle=isNew?'rgba(255,209,102,.15)':'rgba(56,189,248,.06)';ctx.fill();
ctx.strokeStyle=isNew?'#ffd166':'#38bdf833';ctx.lineWidth=isNew?2:1;ctx.stroke();
ctx.fillStyle=isNew?'#ffd166':'#38bdf8';ctx.font=`${isNew?'600 ':'400 '}10px Fira Code`;ctx.textAlign='center';ctx.fillText(w,x+tw/2-2,oy+19);
// Arrows showing causal dependency
if(i>0){ctx.strokeStyle='rgba(56,189,248,.15)';ctx.lineWidth=1;for(let j=0;j<i;j++){
let sx=ox+j*tw+tw/2,sy=oy+30;ctx.beginPath();ctx.moveTo(sx,sy);ctx.quadraticCurveTo((sx+x+tw/2)/2,sy+12+j*2,x+tw/2-2,sy);ctx.stroke()}}});
// "Can see" / "Cannot see" label
if(genPos<12){let nx=ox+genPos*tw;
ctx.save();ctx.shadowColor='#ffd166';ctx.shadowBlur=10;
ctx.beginPath();ctx.roundRect(nx,oy,tw-4,30,6);ctx.strokeStyle='#ffd16666';ctx.lineWidth=2;ctx.setLineDash([4,4]);ctx.stroke();ctx.setLineDash([]);ctx.restore();
ctx.fillStyle='#ffd16666';ctx.font='400 9px Fira Code';ctx.textAlign='center';ctx.fillText('next?',nx+tw/2-2,oy+19)}
// Key insight
ctx.textAlign='left';ctx.fillStyle='rgba(6,6,12,.85)';ctx.beginPath();ctx.roundRect(20,140,710,60,8);ctx.fill();
ctx.fillStyle='#ffd166';ctx.font='600 10px Fira Code';ctx.fillText('Key: Each token can only attend to tokens before it (causal mask)',30,160);
ctx.fillStyle='#7d7a8c';ctx.font='400 9px Fira Code';
ctx.fillText('Pretrain: predict next token on massive text  \u2192  Fine-tune: adapt to downstream tasks',30,180);
ctx.fillText(`Generated ${genPos}/12 tokens`,600,180)}
const ctrl=addControls(el);const btn=document.createElement('button');btn.className='btn';btn.textContent='\u25b6 Generate Next';btn.onclick=genNext;
let timer=null;const abtn=document.createElement('button');abtn.className='btn';abtn.textContent='\u23e9 Auto';
abtn.onclick=()=>{if(timer){clearInterval(timer);timer=null;abtn.classList.remove('active')}else{timer=setInterval(()=>{genNext();if(genPos>=12){clearInterval(timer);timer=null;abtn.classList.remove('active')}},400);abtn.classList.add('active')}};
const rst=document.createElement('button');rst.className='btn';rst.textContent='\u21ba';rst.onclick=()=>{sequence=['The','cat'];genPos=2;draw()};
ctrl.appendChild(btn);ctrl.appendChild(abtn);ctrl.appendChild(rst);draw()})();

// ============ BERT: Interactive masked prediction ============
(function(){
const el=$('demo-bert'),[c,ctx]=createCanvas(el,750,240);
addHint(el,'Click any word to [MASK] it -- BERT uses BOTH left and right context to predict the masked word');
const original=['The','quick','brown','fox','jumps','over','the','lazy','dog'];
let masked=[...original],maskedIdx=-1;
const predictions={0:['The','A','One'],1:['quick','fast','slow'],2:['brown','red','big'],3:['fox','cat','dog'],4:['jumps','runs','leaps'],5:['over','past','across'],6:['the','a','that'],7:['lazy','old','tired'],8:['dog','cat','fox']};
function draw(){ctx.clearRect(0,0,750,240);
ctx.fillStyle='#ffd166';ctx.font='600 10px Fira Code';ctx.fillText('BERT: Bidirectional attention -- click a word to mask it!',20,22);
let ox=20,tw=78,oy=40;
masked.forEach((w,i)=>{let x=ox+i*tw,isMasked=i===maskedIdx;
ctx.save();if(isMasked){ctx.shadowColor='#a78bfa';ctx.shadowBlur=14}
ctx.beginPath();ctx.roundRect(x,oy,tw-6,36,8);
ctx.fillStyle=isMasked?'rgba(167,139,250,.2)':'rgba(78,205,196,.05)';ctx.fill();
ctx.strokeStyle=isMasked?'#a78bfa':'#4ecdc433';ctx.lineWidth=isMasked?2.5:1;ctx.stroke();ctx.restore();
ctx.fillStyle=isMasked?'#a78bfa':'#4ecdc4';ctx.font=`${isMasked?'700 ':'400 '}12px Fira Code`;ctx.textAlign='center';
ctx.fillText(w,x+tw/2-3,oy+22);
// Bidirectional arrows from both sides
if(isMasked){for(let j=0;j<masked.length;j++){if(j===i)continue;
let sx=ox+j*tw+tw/2-3,sy=oy+36;
ctx.strokeStyle=j<i?'rgba(56,189,248,.2)':'rgba(255,107,107,.2)';ctx.lineWidth=1;
ctx.beginPath();ctx.moveTo(sx,sy);ctx.quadraticCurveTo((sx+x+tw/2)/2,sy+15,x+tw/2-3,sy);ctx.stroke()}}});
// Predictions
if(maskedIdx>=0){let py=100,px=20+maskedIdx*tw;
ctx.fillStyle='#a78bfa';ctx.font='600 10px Fira Code';ctx.textAlign='left';ctx.fillText('Predictions:',20,py+8);
let preds=predictions[maskedIdx]||['?','?','?'];
preds.forEach((p,i)=>{let conf=[92,5,3][i];let y=py+15+i*26;
ctx.fillStyle=i===0?'rgba(167,139,250,.15)':'rgba(167,139,250,.04)';
ctx.beginPath();ctx.roundRect(20,y,710,22,4);ctx.fill();
ctx.fillStyle=i===0?'#a78bfa':'#7d7a8c';ctx.font=`${i===0?'600':'400'} 11px Fira Code`;
ctx.fillText(`${p}`,30,y+15);
ctx.fillStyle='#111120';ctx.fillRect(120,y+3,450,16);
ctx.fillStyle=i===0?'#a78bfaaa':'#a78bfa33';ctx.fillRect(120,y+3,450*(conf/100),16);
ctx.fillStyle='#e4e2df';ctx.textAlign='right';ctx.fillText(`${conf}%`,590,y+15)});
ctx.textAlign='left';ctx.fillStyle='#7d7a8c';ctx.font='400 9px Fira Code';
ctx.fillText('\u2190 left context sees right context \u2192    (unlike GPT which only looks left!)',20,py+100)}
else{ctx.fillStyle='#4a475a';ctx.font='400 10px Fira Code';ctx.fillText('Click any word above to mask it and see BERT\'s prediction',20,120)}
ctx.textAlign='left'}
c.onclick=e=>{let r=c.getBoundingClientRect(),mx=(e.clientX-r.left)*750/r.width,my=(e.clientY-r.top)*240/r.height;
if(my>=40&&my<=76){let idx=Math.floor((mx-20)/78);if(idx>=0&&idx<original.length){
maskedIdx=idx;masked=[...original];masked[idx]='[MASK]';draw()}}};
draw()})();

// ============ STYLEGAN: Style mixing at different levels ============
(function(){
const el=$('demo-style'),[c,ctx]=createCanvas(el,750,260);
addHint(el,'Adjust Coarse / Medium / Fine style sliders to control different levels of the generated output');
let coarse=.5,medium=.5,fine=.5;
function drawFace(ox,oy,s,co,med,fi){
let hue=co*360,sat=30+med*50,bri=fi*40+30;
// Head shape (affected by coarse)
ctx.fillStyle=`hsl(${hue},${sat}%,${bri+20}%)`;
let hw=35+co*15,hh=40+co*10;
ctx.beginPath();ctx.ellipse(ox,oy,hw,hh,0,0,TAU);ctx.fill();ctx.strokeStyle='#1e1e32';ctx.lineWidth=1.5;ctx.stroke();
// Eyes (affected by medium)
let eyeGap=12+med*15,eyeSize=3+med*4;
ctx.fillStyle=`hsl(${(hue+180)%360},60%,60%)`;
ctx.beginPath();ctx.arc(ox-eyeGap,oy-5,eyeSize,0,TAU);ctx.fill();
ctx.beginPath();ctx.arc(ox+eyeGap,oy-5,eyeSize,0,TAU);ctx.fill();
// Mouth (affected by medium)
ctx.strokeStyle=`hsl(${hue},${sat+20}%,55%)`;ctx.lineWidth=2;
ctx.beginPath();ctx.arc(ox,oy+10,8+med*6,0,Math.PI);ctx.stroke();
// Hair/texture (affected by fine)
for(let i=0;i<8;i++){let a=-Math.PI+i*.4;let r=hh+2;
ctx.strokeStyle=`hsla(${hue+fi*60},40%,50%,${fi})`;ctx.lineWidth=1+fi*2;
ctx.beginPath();ctx.moveTo(ox+Math.cos(a)*r,oy+Math.sin(a)*r);
ctx.lineTo(ox+Math.cos(a)*(r+10+fi*15),oy+Math.sin(a)*(r+10+fi*15));ctx.stroke()}}
function draw(){ctx.clearRect(0,0,750,260);
// Main face
drawFace(200,120,1,coarse,medium,fine);
ctx.fillStyle='#7d7a8c';ctx.font='500 10px Fira Code';ctx.textAlign='center';ctx.fillText('Generated Face',200,210);
// Style level explanation
let rx=350;
[{name:'Coarse (4-8px)',val:coarse,c:'#ff6b6b',desc:'Pose, face shape, background'},
{name:'Medium (16-32px)',val:medium,c:'#ffd166',desc:'Eye shape, nose, mouth form'},
{name:'Fine (64-1024px)',val:fine,c:'#4ecdc4',desc:'Hair texture, skin tone, freckles'}].forEach((s,i)=>{let y=30+i*68;
ctx.fillStyle=s.c;ctx.font='600 10px Fira Code';ctx.textAlign='left';ctx.fillText(s.name,rx,y+12);
ctx.fillStyle='#7d7a8c';ctx.font='400 9px Fira Code';ctx.fillText(s.desc,rx,y+28);
ctx.fillStyle='#111120';ctx.fillRect(rx,y+34,300,14);
ctx.fillStyle=s.c+'88';ctx.fillRect(rx,y+34,300*s.val,14);
ctx.fillStyle='#e4e2df';ctx.font='500 9px Fira Code';ctx.fillText((s.val*100|0)+'%',rx+305,y+46)});
ctx.fillStyle='rgba(6,6,12,.85)';ctx.beginPath();ctx.roundRect(350,230,390,25,6);ctx.fill();
ctx.fillStyle='#ffd166';ctx.font='400 9px Fira Code';ctx.fillText('Style mixing: swap w vectors at different layers for style transfer',360,247);ctx.textAlign='left'}
const ctrl=addControls(el);
ctrl.innerHTML='<label>Coarse</label><input type="range" min="0" max="100" value="50" id="sco"><label>Medium</label><input type="range" min="0" max="100" value="50" id="sme"><label>Fine</label><input type="range" min="0" max="100" value="50" id="sfi">';
$('sco').oninput=e=>{coarse=e.target.value/100;draw()};
$('sme').oninput=e=>{medium=e.target.value/100;draw()};
$('sfi').oninput=e=>{fine=e.target.value/100;draw()};
const rnd=document.createElement('button');rnd.className='btn';rnd.textContent='\ud83c\udfb2 Random';rnd.onclick=()=>{coarse=Math.random();medium=Math.random();fine=Math.random();$('sco').value=coarse*100;$('sme').value=medium*100;$('sfi').value=fine*100;draw()};
ctrl.appendChild(rnd);draw()})();

// ============ GPT-2: Scaling law visualization ============
(function(){
const el=$('demo-gpt2'),[c,ctx]=createCanvas(el,750,220);
addHint(el,'Hover over model sizes to compare -- observe the smooth power-law improvement as scale increases');
const models=[{n:'GPT-2 Small',p:117,loss:3.29,x:100},{n:'GPT-2 Medium',p:345,loss:2.99,x:260},{n:'GPT-2 Large',p:762,loss:2.76,x:420},{n:'GPT-2 XL',p:1542,loss:2.56,x:580}];
let hovered=-1;
function draw(){ctx.clearRect(0,0,750,220);
let gy=30,gh=120,gx=60,gw=650;
ctx.strokeStyle='#151520';ctx.lineWidth=1;for(let i=0;i<=4;i++){let y=gy+i*gh/4;ctx.beginPath();ctx.moveTo(gx,y);ctx.lineTo(gx+gw,y);ctx.stroke();
ctx.fillStyle='#4a475a';ctx.font='400 8px Fira Code';ctx.textAlign='right';ctx.fillText((3.5-i*.25).toFixed(2),gx-5,y+3)}
ctx.textAlign='left';ctx.fillStyle='#4a475a';ctx.font='400 8px Fira Code';ctx.fillText('Test Loss',gx-5,gy-8);ctx.fillText('Parameters',gx+gw/2,gy+gh+35);
// Smooth curve
ctx.strokeStyle='#38bdf844';ctx.lineWidth=2;ctx.beginPath();
for(let i=0;i<gw;i++){let p=50+i*4;let loss=4.5-Math.log(p)*.35;let y=gy+(3.5-loss)/(3.5-2.5)*gh;ctx.lineTo(gx+i,clamp(y,gy,gy+gh))}ctx.stroke();
// Model points
models.forEach((m,i)=>{let x=m.x,y=gy+(3.5-m.loss)/(3.5-2.5)*gh,active=i===hovered;
let radius=10+Math.log(m.p)*3;
ctx.save();if(active){ctx.shadowColor='#38bdf8';ctx.shadowBlur=20}
ctx.beginPath();ctx.arc(x,y,active?radius+3:radius,0,TAU);
ctx.fillStyle=active?'rgba(56,189,248,.25)':'rgba(56,189,248,.1)';ctx.fill();
ctx.strokeStyle='#38bdf8';ctx.lineWidth=active?2.5:1.5;ctx.stroke();ctx.restore();
ctx.fillStyle='#e4e2df';ctx.font=`${active?'600':'400'} ${active?'11':'9'}px Fira Code`;ctx.textAlign='center';
ctx.fillText(`${(m.p/1000).toFixed(m.p>1000?1:0)}${m.p>1000?'B':'M'}`,x,y-radius-8);
ctx.fillText(m.n.replace('GPT-2 ',''),x,gy+gh+15);
if(active){ctx.fillStyle='#ffd166';ctx.font='600 10px Fira Code';ctx.fillText(`Loss: ${m.loss}`,x,y+radius+16)}});
// Scaling law note
ctx.textAlign='left';ctx.fillStyle='#ffd166';ctx.font='500 9px Fira Code';ctx.fillText('\u26a1 Key insight: Loss decreases as a smooth power law with compute, data, and parameters',60,gy+gh+50)}
c.onmousemove=e=>{let r=c.getBoundingClientRect(),mx=(e.clientX-r.left)*750/r.width;
hovered=-1;models.forEach((m,i)=>{if(Math.abs(mx-m.x)<40)hovered=i});draw()};
c.onmouseleave=()=>{hovered=-1;draw()};draw()})();

// ============ T5: Text-to-text task converter ============
(function(){
const el=$('demo-t5'),[c,ctx]=createCanvas(el,750,230);
addHint(el,'Click different tasks to see how T5 converts everything into a text-to-text format');
const tasks=[
  {name:'Translation',prefix:'translate English to French:',input:'The house is wonderful.','output':'La maison est magnifique.',color:'#38bdf8'},
  {name:'Summarize',prefix:'summarize:',input:'The quick brown fox jumps over the lazy dog in the sunny park on a warm afternoon.','output':'A fox jumps over a dog in the park.',color:'#4ecdc4'},
  {name:'Sentiment',prefix:'sentiment:',input:'This movie was absolutely fantastic!','output':'positive',color:'#ffd166'},
  {name:'QA',prefix:'question: What color? context: The sky is blue.',input:'','output':'blue',color:'#a78bfa'},
  {name:'Grammar',prefix:'cola sentence:',input:'The cat is sat on mat.','output':'not acceptable',color:'#ff6b6b'},
];
let sel=0;
function draw(){ctx.clearRect(0,0,750,230);let t=tasks[sel];
ctx.fillStyle='#38bdf8';ctx.font='700 12px Fira Code';ctx.textAlign='center';ctx.fillText('One model, one format, every task.',375,22);
// Input box
let ix=30,iy=40,iw=320,ih=80;
ctx.fillStyle='rgba(56,189,248,.04)';ctx.beginPath();ctx.roundRect(ix,iy,iw,ih,10);ctx.fill();
ctx.strokeStyle='#38bdf833';ctx.lineWidth=1;ctx.beginPath();ctx.roundRect(ix,iy,iw,ih,10);ctx.stroke();
ctx.fillStyle='#38bdf8';ctx.font='600 9px Fira Code';ctx.textAlign='left';ctx.fillText('INPUT TEXT',ix+10,iy+16);
ctx.fillStyle=t.color;ctx.font='500 10px Fira Code';ctx.fillText(t.prefix,ix+10,iy+35);
ctx.fillStyle='#e4e2df';ctx.font='400 10px DM Sans';
let inputText=t.input||'(in prefix)';let words=inputText.split(' '),line='',ly=iy+52;
words.forEach(w=>{if((line+' '+w).length>42){ctx.fillText(line,ix+10,ly);ly+=15;line=w}else line+=line?' '+w:w});ctx.fillText(line,ix+10,ly);
// Arrow
ctx.fillStyle=t.color;ctx.font='28px sans-serif';ctx.textAlign='center';ctx.fillText('\u2192',375,85);
// Output box
let ox=400,oy=iy;
ctx.fillStyle='rgba(78,205,196,.04)';ctx.beginPath();ctx.roundRect(ox,oy,iw,ih,10);ctx.fill();
ctx.strokeStyle='#4ecdc433';ctx.lineWidth=1;ctx.beginPath();ctx.roundRect(ox,oy,iw,ih,10);ctx.stroke();
ctx.fillStyle='#4ecdc4';ctx.font='600 9px Fira Code';ctx.textAlign='left';ctx.fillText('OUTPUT TEXT',ox+10,oy+16);
ctx.fillStyle='#e4e2df';ctx.font='500 12px Fira Code';ctx.fillText(t.output,ox+10,oy+45);
// Task label
ctx.fillStyle=t.color;ctx.font='900 18px Fraunces';ctx.textAlign='center';ctx.fillText(t.name,375,160);
ctx.fillStyle='#7d7a8c';ctx.font='400 9px Fira Code';ctx.fillText('Every NLP task becomes: "prefix: input" \u2192 "output"',375,180);
ctx.textAlign='left'}
const ctrl=addControls(el);tasks.forEach((t,i)=>{let b=document.createElement('button');b.className='btn'+(i===0?' active':'');b.textContent=t.name;b.style=`color:${t.color};border-color:${t.color}33;font-size:.6rem`;
b.onclick=()=>{sel=i;ctrl.querySelectorAll('.btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');draw()};ctrl.appendChild(b)});draw()})();
</script></body></html>

<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Section III â€” The Revival Â· How AI Works</title>
<link rel="stylesheet" href="styles.css">
</head><body>
<div class="progress-bar" style="background:linear-gradient(90deg,var(--a3),var(--a2))"></div>
<button class="back-top" onclick="window.scrollTo({top:0,behavior:'smooth'})">â†‘</button>
<nav class="topnav"><a href="index.html" class="logo">How AI Works</a><div class="nav-links"><a href="section1.html">I</a><a href="section2.html">II</a><a href="section3.html" class="active">III</a><a href="section4.html">IV</a><a href="section5.html">V</a><a href="section6.html">VI</a><a href="section7.html">VII</a><a href="section8.html">VIII</a></div></nav>

<div class="section-hero" style="background:radial-gradient(ellipse 60% 50% at 50% 70%,rgba(255,209,102,.05),transparent)">
  <div class="era-label" style="color:var(--a3)">Section III Â· 1980s</div>
  <h1>The Revival & Classical ML</h1>
  <p>Backpropagation gains wide recognition, neural nets and decision trees advance in parallel, and AI emerges from its first winter.</p>
  <div class="nav-arrows"><a href="section2.html">â† Section II</a><a href="index.html">Home â†’</a></div>
</div>

<div class="models-container">

<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a3)">1980</span><div class="mc-info"><h3>Neocognitron</h3><p>Fukushima's neocognitron â€” the direct predecessor of CNNs. Introduced "local receptive fields" and "hierarchical feature extraction": lower layers detect edges, higher layers recognize shapes.</p></div></div>
<div class="mc-formula" style="color:var(--a3)">uâ‚› = Ï†(Î£ wâ‚– Â· câ‚–)  local patch â†’ feature â†’ complex feature â†’ object</div>
<div class="mc-demo" id="demo-neo"></div></div>

<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a3)">1986</span><div class="mc-info"><h3>RNN (Recurrent Neural Network)</h3><p>A network that passes information between time steps via hidden states â€” giving neural networks "memory." Reads sequences token by token, updating internal state at each step.</p></div></div>
<div class="mc-formula" style="color:var(--a3)">hâ‚œ = tanh(W_hh Â· hâ‚œâ‚‹â‚ + W_xh Â· xâ‚œ + b) â†’ unfold through time</div>
<div class="mc-demo" id="demo-rnn"></div></div>

<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a3)">1985</span><div class="mc-info"><h3>Boltzmann Machine</h3><p>Hinton & Sejnowski's stochastic neural network â€” uses an energy function to describe the probability of states. Lower energy = higher probability. Finds low-energy states via simulated annealing.</p></div></div>
<div class="mc-formula" style="color:var(--a3)">P(state) âˆ e^{-E/T}  E = -Î£áµ¢â±¼ wáµ¢â±¼Â·sáµ¢Â·sâ±¼  lower E â†’ higher P</div>
<div class="mc-demo" id="demo-boltz"></div></div>

<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a3)">1986</span><div class="mc-info"><h3>Backpropagation</h3><p>Rumelhart, Hinton & Williams popularized backpropagation â€” using the chain rule to propagate errors from output to input, computing gradients for every weight, making multi-layer networks trainable.</p></div></div>
<div class="mc-formula" style="color:var(--a3)">Î´â±¼ = f'(zâ±¼) Â· Î£â‚– wâ±¼â‚– Â· Î´â‚–  Î”wáµ¢â±¼ = -Î· Â· Î´â±¼ Â· aáµ¢ â†’ gradient descent</div>
<div class="mc-demo" id="demo-bp"></div></div>

<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a3)">1986</span><div class="mc-info"><h3>Decision Tree</h3><p>Quinlan's ID3/C4.5 and Breiman's CART â€” use information gain or Gini impurity to split data optimally. Clear, interpretable, and understandable by everyone.</p></div></div>
<div class="mc-formula" style="color:var(--a3)">InfoGain = H(S) - Î£(|Sáµ¥|/|S|)Â·H(Sáµ¥)  Gini = 1 - Î£ páµ¢Â²</div>
<div class="mc-demo" id="demo-tree"></div></div>

</div>
<footer><a href="section2.html">â† Section II</a> Â· <a href="section4.html">Section IV: Golden Age &rarr;</a></footer>
<script src="shared.js"></script>
<script>
// ============================================================
//  NEOCOGNITRON â€” draw on grid, see 4 conv feature maps + pooling
// ============================================================
(function(){
const el=$('demo-neo'), [c,ctx]=createCanvas(el,750,280);
addHint(el,'ğŸ–±ï¸ Draw on the 16Ã—16 grid Â· See Sobel, Laplacian, Sharpen & Diagonal edge detection live');
const G=16, gs=14;
let grid=Array(G).fill(0).map(()=>Array(G).fill(0)), drawing=false;
const kernels=[
  {name:'V-Sobel',k:[[1,0,-1],[2,0,-2],[1,0,-1]],color:'#ffd166'},
  {name:'H-Sobel',k:[[1,2,1],[0,0,0],[-1,-2,-1]],color:'#a78bfa'},
  {name:'Laplacian',k:[[0,-1,0],[-1,4,-1],[0,-1,0]],color:'#4ecdc4'},
  {name:'Diagonal',k:[[2,-1,0],[-1,2,-1],[0,-1,2]],color:'#f472b6'}
];
function conv(k){let R=G-2,o=[];for(let r=0;r<R;r++){o[r]=[];for(let cc=0;cc<R;cc++){let s=0;for(let kr=0;kr<3;kr++)for(let kc=0;kc<3;kc++)s+=grid[r+kr][cc+kc]*k[kr][kc];o[r][cc]=Math.max(0,s)}}return o}
function pool(fm){let R=Math.floor(fm.length/2),o=[];for(let r=0;r<R;r++){o[r]=[];for(let cc=0;cc<R;cc++)o[r][cc]=Math.max(fm[r*2][cc*2],fm[r*2+1]?.[cc*2]||0,fm[r*2]?.[cc*2+1]||0,fm[r*2+1]?.[cc*2+1]||0)}return o}
function draw(){
  ctx.clearRect(0,0,750,280);
  // Input grid
  let ox=15,oy=30;
  ctx.fillStyle='#7d7a8c';ctx.font='500 9px Fira Code';ctx.fillText('Input 16Ã—16',ox,22);
  for(let r=0;r<G;r++)for(let cc=0;cc<G;cc++){
    let v=grid[r][cc];
    ctx.fillStyle=v>0?`rgba(78,205,196,${v})`:'#0a0a14';
    ctx.fillRect(ox+cc*gs,oy+r*gs,gs-1,gs-1);
  }
  // Feature maps
  let fx=250;
  kernels.forEach((kern,ki)=>{
    let fm=conv(kern.k), pooled=pool(fm);
    let colR=parseInt(kern.color.slice(1,3),16),colG=parseInt(kern.color.slice(3,5),16),colB=parseInt(kern.color.slice(5,7),16);
    // Conv output
    ctx.fillStyle=kern.color; ctx.font='500 8px Fira Code'; ctx.fillText(kern.name,fx,22);
    let mx=0;fm.forEach(r=>r.forEach(v=>{if(v>mx)mx=v}));if(!mx)mx=1;
    let fs=7;
    for(let r=0;r<fm.length;r++)for(let cc=0;cc<fm[0].length;cc++){
      let v=fm[r][cc]/mx;
      ctx.fillStyle=`rgba(${colR},${colG},${colB},${v})`;
      ctx.fillRect(fx+cc*fs,oy+r*fs,fs-1,fs-1);
    }
    // Pooled output below
    let py=oy+fm.length*fs+12;
    ctx.fillStyle='#4a475a';ctx.font='400 7px Fira Code';ctx.fillText('pool 2Ã—2',fx,py-3);
    let pmx=0;pooled.forEach(r=>r.forEach(v=>{if(v>pmx)pmx=v}));if(!pmx)pmx=1;
    let ps=9;
    for(let r=0;r<pooled.length;r++)for(let cc=0;cc<pooled[0].length;cc++){
      let v=pooled[r][cc]/pmx;
      ctx.fillStyle=`rgba(${colR},${colG},${colB},${v*.8})`;
      ctx.fillRect(fx+cc*ps,py+r*ps,ps-1,ps-1);
    }
    fx+=125;
  });
}
function paint(e){let r=c.getBoundingClientRect(),mx=(e.clientX-r.left)*750/r.width,my=(e.clientY-r.top)*280/r.height;
  let gx=Math.floor((mx-15)/gs),gy=Math.floor((my-30)/gs);
  if(gx>=0&&gx<G&&gy>=0&&gy<G){grid[gy][gx]=Math.min(1,grid[gy][gx]+.35);
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(([dy,dx])=>{let ny=gy+dy,nx=gx+dx;if(ny>=0&&ny<G&&nx>=0&&nx<G)grid[ny][nx]=Math.min(1,grid[ny][nx]+.12)});draw()}}
c.onmousedown=e=>{drawing=true;paint(e)};c.onmousemove=e=>{if(drawing)paint(e)};c.onmouseup=()=>drawing=false;c.onmouseleave=()=>drawing=false;
const ctrl=addControls(el);const btn=document.createElement('button');btn.className='btn';btn.textContent='ğŸ—‘ Clear';
btn.onclick=()=>{grid=Array(G).fill(0).map(()=>Array(G).fill(0));draw()};ctrl.appendChild(btn);draw()
})();

// ============================================================
//  RNN â€” animated text processing with hidden state heatmap
// ============================================================
(function(){
const el=$('demo-rnn'), [c,ctx]=createCanvas(el,750,340);
addHint(el,'Type text Â· Click â–¶ Step to process word by word Â· Watch hidden state evolve');
let text='The cat sat on the mat', words=[], step=-1, hiddenDim=6, hidden=Array(hiddenDim).fill(0), history=[];

function reset(){words=text.split(/\s+/);step=-1;hidden=Array(hiddenDim).fill(0);history=[];}
reset();
function advance(){
  step++;if(step>=words.length){reset();return}
  let w=words[step],cv=0;for(let i=0;i<w.length;i++)cv+=w.charCodeAt(i);cv/=(w.length*128);
  hidden=hidden.map((h,i)=>Math.tanh(h*.55+cv*(1.2-i*.15)+Math.sin(step+i)*.08));
  history.push({word:words[step],h:[...hidden]});
  draw();
}

function draw(){
  ctx.clearRect(0,0,750,340);
  let ox=30,oy=50,gap=Math.min(85,680/Math.max(words.length,1));

  // Word sequence
  words.forEach((w,i)=>{
    let x=ox+i*gap, done=i<=step, active=i===step;
    // Connection
    if(i>0){
      ctx.strokeStyle=i<=step?'rgba(167,139,250,.3)':'#151520';ctx.lineWidth=done?2:1;
      ctx.beginPath();ctx.moveTo(x-gap+25,oy);ctx.lineTo(x-8,oy);ctx.stroke();
      if(done){let ax=x-8;ctx.fillStyle='rgba(167,139,250,.3)';ctx.beginPath();ctx.moveTo(ax,oy-4);ctx.lineTo(ax+6,oy);ctx.lineTo(ax,oy+4);ctx.closePath();ctx.fill();}
    }
    // Node
    ctx.save();
    if(active){ctx.shadowColor='#a78bfa';ctx.shadowBlur=16;}
    ctx.beginPath();ctx.roundRect?ctx.roundRect(x-8,oy-18,Math.max(w.length*8+12,36),36,8):ctx.arc(x+10,oy,18,0,TAU);
    ctx.fillStyle=active?'rgba(167,139,250,.2)':done?'rgba(167,139,250,.06)':'#0c0c16';ctx.fill();
    ctx.strokeStyle=active?'#a78bfa':done?'#a78bfa44':'#1e1e32';ctx.lineWidth=active?2:1;ctx.stroke();
    ctx.restore();
    ctx.fillStyle=active?'#fff':done?'#a78bfa':'#4a475a';ctx.font=`${active?'600 ':'400 '}11px Fira Code`;ctx.textAlign='center';
    ctx.fillText(w,x+Math.max(w.length*4+2,10),oy+4);
  });

  // Hidden state heatmap
  if(history.length>0){
    let hy=120,hx=30,cellW=Math.min(85,680/Math.max(history.length,1)),cellH=28;
    ctx.fillStyle='#7d7a8c';ctx.font='500 9px Fira Code';ctx.textAlign='left';
    ctx.fillText('Hidden State hâ‚œ over time:',hx,hy-8);

    // Dimension labels
    for(let d=0;d<hiddenDim;d++){
      ctx.fillStyle='#4a475a';ctx.font='400 8px Fira Code';ctx.textAlign='right';
      ctx.fillText(`h[${d}]`,hx-5,hy+d*cellH+cellH/2+3);
    }

    // Heatmap cells
    history.forEach((h,ti)=>{
      let x=hx+ti*cellW;
      h.h.forEach((v,di)=>{
        let y=hy+di*cellH;
        let abs=Math.abs(v);
        if(v>=0) ctx.fillStyle=`rgba(78,205,196,${abs})`;
        else ctx.fillStyle=`rgba(255,107,107,${abs})`;
        ctx.fillRect(x,y,cellW-2,cellH-2);
        // Value
        if(cellW>30){ctx.fillStyle=abs>.5?'#fff':'#7d7a8c';ctx.font='400 8px Fira Code';ctx.textAlign='center';
          ctx.fillText(v.toFixed(2),x+cellW/2-1,y+cellH/2+3);}
      });
      // Word label below
      ctx.fillStyle=ti===step-1?'#a78bfa':'#4a475a';ctx.font='400 8px Fira Code';ctx.textAlign='center';
      ctx.fillText(h.word,x+cellW/2-1,hy+hiddenDim*cellH+12);
    });

    // Current hidden vector visualization
    let vy=hy+hiddenDim*cellH+30;
    ctx.fillStyle='#ffd166';ctx.font='600 10px Fira Code';ctx.textAlign='left';
    ctx.fillText(`hâ‚œ = [${history[history.length-1].h.map(v=>v.toFixed(2)).join(', ')}]`,hx,vy);
  }
  ctx.textAlign='left';
}

const ctrl=addControls(el);
let inp=document.createElement('input');inp.type='text';inp.value=text;
inp.style='background:var(--bg);border:1px solid var(--border);color:var(--text);padding:.3rem .6rem;border-radius:5px;font-family:var(--mono);font-size:.78rem;width:200px;outline:none';
inp.oninput=e=>{text=e.target.value;reset();draw()};
const btn=document.createElement('button');btn.className='btn';btn.textContent='â–¶ Step';btn.onclick=advance;
let timer=null;const abtn=document.createElement('button');abtn.className='btn';abtn.textContent='â© Auto';
abtn.onclick=()=>{if(timer){clearInterval(timer);timer=null;abtn.classList.remove('active');abtn.textContent='â© Auto'}else{timer=setInterval(advance,600);abtn.classList.add('active');abtn.textContent='â¹ Stop'}};
const rst=document.createElement('button');rst.className='btn';rst.textContent='â†º';rst.onclick=()=>{reset();draw()};
ctrl.appendChild(inp);ctrl.appendChild(btn);ctrl.appendChild(abtn);ctrl.appendChild(rst);draw()
})();

// ============================================================
//  BOLTZMANN â€” energy landscape with simulated annealing
// ============================================================
(function(){
const el=$('demo-boltz'), [c,ctx]=createCanvas(el,750,300);
addHint(el,'ğŸ–±ï¸ Click nodes to flip Â±  Â· Press "Anneal" to find low energy state automatically');
let N=12, nodes=[], edges=[], eHist=[];
for(let i=0;i<N;i++){let a=i*TAU/N;nodes.push({x:260+Math.cos(a)*110,y:150+Math.sin(a)*100,s:Math.random()>.5?1:-1})}
for(let i=0;i<N;i++)for(let j=i+1;j<N;j++)if(Math.random()<.35)edges.push({i,j,w:rand(-.7,.7)});
function E(){return edges.reduce((e,ed)=>e-ed.w*nodes[ed.i].s*nodes[ed.j].s,0)}
eHist.push(E());

function draw(){
  ctx.clearRect(0,0,750,300);
  // Edges
  edges.forEach(e=>{let a=nodes[e.i],b=nodes[e.j];
    ctx.strokeStyle=e.w>0?`rgba(78,205,196,${Math.abs(e.w)*.7})`:`rgba(255,107,107,${Math.abs(e.w)*.7})`;
    ctx.lineWidth=.5+Math.abs(e.w)*3.5;ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);ctx.stroke()});
  // Nodes
  nodes.forEach(n=>{
    ctx.save();ctx.shadowColor=n.s>0?'#4ecdc4':'#ff6b6b';ctx.shadowBlur=10;
    ctx.beginPath();ctx.arc(n.x,n.y,18,0,TAU);
    ctx.fillStyle=n.s>0?'#4ecdc4':'#ff6b6b';ctx.fill();ctx.restore();
    ctx.strokeStyle='#06060c';ctx.lineWidth=2.5;ctx.beginPath();ctx.arc(n.x,n.y,18,0,TAU);ctx.stroke();
    ctx.fillStyle='#06060c';ctx.font='bold 14px Fira Code';ctx.textAlign='center';ctx.textBaseline='middle';
    ctx.fillText(n.s>0?'+':'âˆ’',n.x,n.y)});
  // Energy chart
  let cx=510,cy=15,cw=225,ch=140;
  ctx.fillStyle='rgba(6,6,12,.9)';ctx.beginPath();ctx.roundRect(cx,cy,cw,ch+35,10);ctx.fill();
  ctx.strokeStyle='#1e1e32';ctx.lineWidth=1;ctx.beginPath();ctx.roundRect(cx,cy,cw,ch+35,10);ctx.stroke();
  ctx.fillStyle='#ffd166';ctx.font='600 11px Fira Code';ctx.textAlign='left';ctx.textBaseline='alphabetic';ctx.fillText('Energy over time',cx+12,cy+18);
  if(eHist.length>1){let mn=Math.min(...eHist),mx=Math.max(...eHist);if(mn===mx)mx=mn+1;
    ctx.strokeStyle='#ffd166';ctx.lineWidth=1.5;ctx.beginPath();
    eHist.slice(-80).forEach((e,i,arr)=>{let x=cx+10+i*(cw-20)/80,y=cy+28+ch-5-((e-mn)/(mx-mn))*(ch-10);
      i?ctx.lineTo(x,y):ctx.moveTo(x,y)});ctx.stroke();}
  ctx.fillStyle='#ff6b6b';ctx.font='700 20px Fraunces';ctx.fillText(`E = ${E().toFixed(2)}`,cx+12,cy+ch+28);
  // Legend
  ctx.fillStyle='#7d7a8c';ctx.font='400 9px Fira Code';
  ctx.fillText(`${N} nodes Â· ${edges.length} connections`,15,290);
  ctx.textAlign='left';ctx.textBaseline='alphabetic';
}
c.onclick=e=>{let r=c.getBoundingClientRect(),mx=(e.clientX-r.left)*750/r.width,my=(e.clientY-r.top)*300/r.height;
  nodes.forEach(n=>{if(dist(mx,my,n.x,n.y)<22)n.s*=-1});eHist.push(E());if(eHist.length>80)eHist.shift();draw()};
const ctrl=addControls(el);
const abtn=document.createElement('button');abtn.className='btn';abtn.textContent='â„ï¸ Simulated Annealing';
abtn.onclick=()=>{let temp=3,steps=0;abtn.classList.add('active');
  const iv=setInterval(()=>{let i=randInt(0,N),oldE=E();nodes[i].s*=-1;let newE=E();
    if(newE>oldE&&Math.random()>Math.exp((oldE-newE)/temp))nodes[i].s*=-1;
    temp*=.97;steps++;eHist.push(E());if(eHist.length>80)eHist.shift();draw();
    if(temp<.01||steps>150){clearInterval(iv);abtn.classList.remove('active')}},25)};
const rbtn=document.createElement('button');rbtn.className='btn';rbtn.textContent='ğŸ”€ Randomize';
rbtn.onclick=()=>{nodes.forEach(n=>n.s=Math.random()>.5?1:-1);eHist.push(E());draw()};
ctrl.appendChild(abtn);ctrl.appendChild(rbtn);draw()
})();

// ============================================================
//  BACKPROP â€” MLP with animated training + loss curve
// ============================================================
(function(){
const el=$('demo-bp'), [c,ctx]=createCanvas(el,750,340);
addHint(el,'Click "Train" or "Auto" Â· Watch weights strengthen, gradients flow, and loss decrease');
const arch=[2,4,3,1]; let ws=[],bs=[],activations=[],grads=[];
let target=.85, epoch=0, losses=[];
// Init weights
for(let l=0;l<arch.length-1;l++){
  let lw=[];for(let j=0;j<arch[l+1];j++){let ww=[];for(let i=0;i<arch[l];i++)ww.push(rand(-.6,.6));lw.push(ww);}ws.push(lw);
  bs.push(Array(arch[l+1]).fill(0).map(()=>rand(-.3,.3)));
}
activations=arch.map(n=>Array(n).fill(0));activations[0]=[.5,.8];
grads=arch.map(n=>Array(n).fill(0));
function fwd(){for(let l=1;l<arch.length;l++)for(let j=0;j<arch[l];j++){let s=bs[l-1][j];for(let i=0;i<arch[l-1];i++)s+=ws[l-1][j][i]*activations[l-1][i];activations[l][j]=sigmoid(s)}}
function train(){fwd();let err=activations[arch.length-1][0]-target;grads=arch.map(n=>Array(n).fill(0));grads[arch.length-1][0]=err;
  for(let l=arch.length-2;l>=0;l--)for(let i=0;i<arch[l];i++){let g=0;for(let j=0;j<arch[l+1];j++){g+=grads[l+1][j]*ws[l][j][i];ws[l][j][i]-=.25*grads[l+1][j]*activations[l][i];bs[l][j]-=.25*grads[l+1][j]}grads[l][i]=g*activations[l][i]*(1-activations[l][i])}
  epoch++;losses.push((activations[arch.length-1][0]-target)**2);if(losses.length>150)losses.shift()}

function draw(){
  fwd();ctx.clearRect(0,0,750,340);
  const lx=[80,210,360,480];
  const np=arch.map((n,li)=>Array(n).fill(0).map((_,ni)=>({x:lx[li],y:170-((n-1)*38)/2+ni*38})));
  // Edges
  for(let l=0;l<arch.length-1;l++)for(let j=0;j<arch[l+1];j++)for(let i=0;i<arch[l];i++){
    let a=np[l][i],b=np[l+1][j],w=ws[l][j][i];
    ctx.strokeStyle=w>0?`rgba(78,205,196,${clamp(Math.abs(w),.05,1)})`:`rgba(255,107,107,${clamp(Math.abs(w),.05,1)})`;
    ctx.lineWidth=.3+Math.abs(w)*2.5;ctx.beginPath();ctx.moveTo(a.x+14,a.y);ctx.lineTo(b.x-14,b.y);ctx.stroke()}
  // Nodes
  arch.forEach((n,li)=>{for(let ni=0;ni<n;ni++){let p=np[li][ni],v=activations[li][ni],g=Math.abs(grads[li]?grads[li][ni]:0);
    ctx.save();if(g>.02){ctx.shadowColor='#ffd166';ctx.shadowBlur=g*20;}
    ctx.beginPath();ctx.arc(p.x,p.y,14,0,TAU);ctx.fillStyle=`rgba(167,139,250,${.1+v*.5})`;ctx.fill();
    ctx.strokeStyle=g>.02?`rgba(255,209,102,${clamp(g*5,.1,1)})`:'#1e1e32';ctx.lineWidth=g>.02?2.5:1;ctx.stroke();ctx.restore();
    ctx.fillStyle='#e4e2df';ctx.font='500 8px Fira Code';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(v.toFixed(2),p.x,p.y)}});
  // Layer labels
  ['Input','Hidden 1','Hidden 2','Output'].forEach((l,i)=>{ctx.fillStyle='#4a475a';ctx.font='400 8px Fira Code';ctx.textAlign='center';ctx.textBaseline='alphabetic';ctx.fillText(l,lx[i],320)});
  // Loss chart (right)
  let cx=540,cy=15,cw=195,ch=120;
  ctx.fillStyle='rgba(6,6,12,.88)';ctx.beginPath();ctx.roundRect(cx,cy,cw,ch+70,10);ctx.fill();
  ctx.strokeStyle='#1e1e32';ctx.lineWidth=1;ctx.beginPath();ctx.roundRect(cx,cy,cw,ch+70,10);ctx.stroke();
  ctx.fillStyle='#ffd166';ctx.font='600 10px Fira Code';ctx.textAlign='left';ctx.fillText('Training Loss',cx+10,cy+16);
  if(losses.length>1){let mx=Math.max(...losses,.001);ctx.strokeStyle='#ff6b6b';ctx.lineWidth=1.5;ctx.beginPath();
    losses.forEach((l,i)=>{let x=cx+8+i*((cw-16)/150),y=cy+24+ch-5-(l/mx)*(ch-10);i?ctx.lineTo(x,y):ctx.moveTo(x,y)});ctx.stroke()}
  ctx.fillStyle='#7d7a8c';ctx.font='400 9px Fira Code';
  ctx.fillText(`Epoch: ${epoch}`,cx+10,cy+ch+38);
  ctx.fillText(`Output: ${activations[arch.length-1][0].toFixed(4)}`,cx+10,cy+ch+52);
  ctx.fillText(`Target: ${target}`,cx+10,cy+ch+66);
  let loss=losses.length?(losses[losses.length-1]).toFixed(6):'â€”';
  ctx.fillStyle='#ff6b6b';ctx.fillText(`Loss: ${loss}`,cx+100,cy+ch+38);
  ctx.textAlign='left';ctx.textBaseline='alphabetic';
}
const ctrl=addControls(el);
const btn=document.createElement('button');btn.className='btn';btn.textContent='â–¶ Train Ã—10';btn.onclick=()=>{for(let i=0;i<10;i++)train();draw()};
let timer=null;const abtn=document.createElement('button');abtn.className='btn';abtn.textContent='â© Auto';
abtn.onclick=()=>{if(timer){clearInterval(timer);timer=null;abtn.classList.remove('active');abtn.textContent='â© Auto'}else{timer=setInterval(()=>{train();draw()},30);abtn.classList.add('active');abtn.textContent='â¹ Stop'}};
const rst=document.createElement('button');rst.className='btn';rst.textContent='â†º Reset';
rst.onclick=()=>{for(let l=0;l<arch.length-1;l++){for(let j=0;j<arch[l+1];j++)for(let i=0;i<arch[l];i++)ws[l][j][i]=rand(-.6,.6);bs[l]=bs[l].map(()=>rand(-.3,.3))}epoch=0;losses=[];draw()};
ctrl.appendChild(btn);ctrl.appendChild(abtn);ctrl.appendChild(rst);fwd();draw()
})();

// ============================================================
//  DECISION TREE â€” interactive classifier with animated path
// ============================================================
(function(){
const el=$('demo-tree'), [c,ctx]=createCanvas(el,750,340);
addHint(el,'ğŸ›ï¸ Drag the 3 feature sliders Â· Watch the decision path light up through the tree');
let temp=28, humid=65, wind=12;
const tree=[
  {q:'ğŸŒ¡ï¸ Temp > 25Â°?',x:375,y:40,type:'node'},
  {q:'ğŸ’§ Humid > 70%?',x:180,y:130,type:'node'},
  {q:'ğŸ’¨ Wind > 15?',x:570,y:130,type:'node'},
  {q:'ğŸ–ï¸ Stay Inside',x:90,y:230,type:'leaf',emoji:'ğŸ–ï¸'},
  {q:'âš½ Play Sports',x:270,y:230,type:'leaf',emoji:'âš½'},
  {q:'ğŸª Fly a Kite',x:470,y:230,type:'leaf',emoji:'ğŸª'},
  {q:'ğŸš¶ Go Walking',x:660,y:230,type:'leaf',emoji:'ğŸš¶'},
];
const edgesData=[[0,1,'Yes'],[0,2,'No'],[1,3,'Yes'],[1,4,'No'],[2,5,'Yes'],[2,6,'No']];
function classify(){
  if(temp>25){if(humid>70)return[0,1,3];return[0,1,4];}
  if(wind>15)return[0,2,5];return[0,2,6];
}

function draw(){
  ctx.clearRect(0,0,750,340);
  let path=classify();
  // Edges
  edgesData.forEach(([i,j,label])=>{
    let a=tree[i],b=tree[j], on=path.includes(i)&&path.includes(j);
    ctx.save();
    if(on){ctx.shadowColor='#ffd166';ctx.shadowBlur=8;}
    ctx.strokeStyle=on?'#ffd166':'#1e1e32'; ctx.lineWidth=on?3:1.5;
    ctx.beginPath();ctx.moveTo(a.x,a.y+20);ctx.lineTo(b.x,b.y-20);ctx.stroke();
    ctx.restore();
    // Label
    let mx=(a.x+b.x)/2+(j%2===1?-15:15), my=(a.y+b.y)/2;
    ctx.fillStyle=on?'#ffd166':'#4a475a';ctx.font=`${on?'600':'400'} 10px Fira Code`;ctx.textAlign='center';ctx.fillText(label,mx,my);
  });
  // Nodes
  tree.forEach((n,i)=>{
    let on=path.includes(i), isLeaf=n.type==='leaf';
    let w=isLeaf?90:120, h=isLeaf?40:32;
    ctx.save();
    if(on&&isLeaf){ctx.shadowColor='#4ecdc4';ctx.shadowBlur=20;}
    else if(on){ctx.shadowColor='#ffd166';ctx.shadowBlur=12;}
    ctx.beginPath();ctx.roundRect(n.x-w/2,n.y-h/2,w,h,isLeaf?12:8);
    ctx.fillStyle=on?(isLeaf?'rgba(78,205,196,.15)':'rgba(255,209,102,.08)'):'#0c0c16';ctx.fill();
    ctx.strokeStyle=on?(isLeaf?'#4ecdc4':'#ffd166'):'#1e1e32';ctx.lineWidth=on?2:1;ctx.stroke();
    ctx.restore();
    ctx.fillStyle=on?'#fff':'#7d7a8c';ctx.font=`${on?'600':'400'} ${isLeaf?'14':'10'}px ${isLeaf?'sans-serif':'Fira Code'}`;
    ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(n.q,n.x,n.y);
  });
  // Result
  let leafIdx=path[path.length-1], leaf=tree[leafIdx];
  ctx.fillStyle='#ffd166';ctx.font='900 24px Fraunces';ctx.textAlign='center';ctx.textBaseline='alphabetic';
  ctx.fillText(`â†’ ${leaf.q}`,375,310);
  // Feature values display
  ctx.fillStyle='#7d7a8c';ctx.font='400 10px Fira Code';
  ctx.fillText(`ğŸŒ¡ï¸ ${temp}Â°C ğŸ’§ ${humid}% ğŸ’¨ ${wind} km/h`,375,335);
  ctx.textAlign='left';ctx.textBaseline='alphabetic';
}

const ctrl=addControls(el);
ctrl.innerHTML=`<label>ğŸŒ¡ï¸</label><input type="range" min="0" max="45" value="28" id="tt"><span id="ttv" style="font-family:var(--mono);font-size:.7rem;color:var(--a1)">28Â°C</span>
<label>ğŸ’§</label><input type="range" min="0" max="100" value="65" id="hh"><span id="hhv" style="font-family:var(--mono);font-size:.7rem;color:var(--a6)">65%</span>
<label>ğŸ’¨</label><input type="range" min="0" max="30" value="12" id="ww"><span id="wwv" style="font-family:var(--mono);font-size:.7rem;color:var(--a2)">12</span>`;
$('tt').oninput=e=>{temp=+e.target.value;$('ttv').textContent=temp+'Â°C';draw()};
$('hh').oninput=e=>{humid=+e.target.value;$('hhv').textContent=humid+'%';draw()};
$('ww').oninput=e=>{wind=+e.target.value;$('wwv').textContent=wind+'';draw()};
draw()
})();
</script>
</body></html>

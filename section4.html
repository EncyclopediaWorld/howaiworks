<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Section IV — Golden Age of Statistical Learning · How AI Works</title>
<link rel="stylesheet" href="styles.css">
</head><body>
<div class="progress-bar" style="background:linear-gradient(90deg,var(--a2),var(--a6))"></div>
<button class="back-top" onclick="window.scrollTo({top:0,behavior:'smooth'})">↑</button>
<nav class="topnav"><a href="index.html" class="logo">How AI Works</a><div class="nav-links"><a href="section1.html">I</a><a href="section2.html">II</a><a href="section3.html">III</a><a href="section4.html" class="active">IV</a><a href="section5.html">V</a><a href="section6.html">VI</a><a href="section7.html">VII</a><a href="section8.html">VIII</a></div></nav>
<div class="section-hero" style="background:radial-gradient(ellipse 60% 50% at 50% 70%,rgba(78,205,196,.06),transparent)">
  <div class="era-label" style="color:var(--a2)">Section IV · 1990s-2001</div>
  <h1>The Golden Age of Statistical Learning</h1>
  <p>SVM, LSTM, Random Forest -- classic methods flourish in a golden era of machine learning breakthroughs.</p>
  <div class="nav-arrows"><a href="section3.html">&larr; Section III</a><a href="section5.html">Section V &rarr;</a></div>
</div>
<div class="models-container">

<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a2)">1989/98</span><div class="mc-info"><h3>CNN / LeNet</h3><p>LeCun's convolutional neural network -- convolution kernels scan the image to extract local features, pooling reduces dimensionality, and fully-connected layers produce the classification. The birth of modern computer vision.</p></div></div>
<div class="mc-formula" style="color:var(--a2)">Conv: (f*x)[i] = sum f[k] x[i+k]  ->  Pool  ->  FC  ->  Softmax</div>
<div class="mc-demo" id="demo-cnn"></div></div>

<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a2)">1997</span><div class="mc-info"><h3>LSTM (Long Short-Term Memory)</h3><p>Hochreiter & Schmidhuber's LSTM -- forget gate, input gate, and output gate work together to solve the vanishing gradient problem and capture long-range dependencies in sequences.</p></div></div>
<div class="mc-formula" style="color:var(--a2)">f_t = sigma(W_f [h_{t-1},x_t])   c_t = f_t c_{t-1} + i_t c~_t   h_t = o_t tanh(c_t)</div>
<div class="mc-demo" id="demo-lstm"></div></div>

<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a2)">1995</span><div class="mc-info"><h3>SVM (Support Vector Machine)</h3><p>Vapnik's support vector machine -- find the hyperplane that maximizes the margin between two classes. The kernel trick maps data into higher dimensions to handle nonlinear boundaries.</p></div></div>
<div class="mc-formula" style="color:var(--a2)">max 2/||w||  s.t. y_i(w x_i + b) >= 1     kernel: K(x,x') = phi(x) phi(x')</div>
<div class="mc-demo" id="demo-svm"></div></div>

<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a2)">1990s</span><div class="mc-info"><h3>GMM + EM Algorithm</h3><p>Gaussian Mixture Models -- fit complex data with a superposition of multiple Gaussians. The EM algorithm alternates between E-step (assign soft clusters) and M-step (update parameters).</p></div></div>
<div class="mc-formula" style="color:var(--a2)">p(x) = sum pi_k N(x | mu_k, sigma_k^2)    E-step -> M-step -> repeat</div>
<div class="mc-demo" id="demo-gmm"></div></div>

<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a2)">2001</span><div class="mc-info"><h3>Random Forest</h3><p>Breiman's random forest -- ensemble many random decision trees, each trained on a bootstrap sample with random feature subsets, then take majority vote. Simple, robust, and resistant to overfitting.</p></div></div>
<div class="mc-formula" style="color:var(--a2)">y_hat = mode({ Tree_1(x), Tree_2(x), ..., Tree_K(x) })    bagging + feature randomness</div>
<div class="mc-demo" id="demo-rf"></div></div>

<div class="model-card"><div class="mc-head"><span class="mc-year" style="color:var(--a2)">1997</span><div class="mc-info"><h3>AdaBoost</h3><p>Adaptive boosting -- each round increases the weight of misclassified samples, forcing subsequent weak learners to focus on the hard cases. Weak classifiers combine into a powerful ensemble.</p></div></div>
<div class="mc-formula" style="color:var(--a2)">H(x) = sign( sum alpha_t h_t(x) )    alpha_t = 0.5 ln((1-e_t)/e_t)</div>
<div class="mc-demo" id="demo-ada"></div></div>

</div>
<footer><a href="section3.html">&larr; Section III</a> &middot; <a href="section5.html">Section V: Eve of Deep Learning &rarr;</a></footer>
<script src="shared.js"></script>
<script>
// ============ CNN: Draw digit, live conv->pool->FC pipeline ============
(function(){
const el=$('demo-cnn'),[c,ctx]=createCanvas(el,750,320);
addHint(el,'Draw on the 16x16 grid -- watch convolution kernels activate, pool, then classify in real-time');
const G=16,gs=13;let grid=Array(G).fill(0).map(()=>Array(G).fill(0)),drawing=false;
const K=[{n:'Edge-V',k:[[1,0,-1],[2,0,-2],[1,0,-1]],c:[255,209,102]},{n:'Edge-H',k:[[1,2,1],[0,0,0],[-1,-2,-1]],c:[167,139,250]},{n:'Sharpen',k:[[-1,-1,-1],[-1,9,-1],[-1,-1,-1]],c:[78,205,196]},{n:'Corner',k:[[2,-1,0],[-1,2,-1],[0,-1,2]],c:[244,114,182]}];
function conv(g,k){let R=G-2,o=[];for(let r=0;r<R;r++){o[r]=[];for(let cc=0;cc<R;cc++){let s=0;for(let kr=0;kr<3;kr++)for(let kc=0;kc<3;kc++)s+=g[r+kr][cc+kc]*k[kr][kc];o[r][cc]=Math.max(0,s)}}return o}
function pool2(f){let o=[];for(let r=0;r<f.length-1;r+=2){o[r>>1]=[];for(let c=0;c<f[0].length-1;c+=2)o[r>>1][c>>1]=Math.max(f[r][c],f[r][c+1],f[r+1][c],f[r+1][c+1])}return o}
function draw(){ctx.clearRect(0,0,750,320);let ox=12,oy=28;
ctx.fillStyle='#7d7a8c';ctx.font='600 9px Fira Code';ctx.fillText('INPUT',ox,20);
for(let r=0;r<G;r++)for(let cc=0;cc<G;cc++){ctx.fillStyle=grid[r][cc]>0?`rgba(78,205,196,${grid[r][cc]})`:'#0a0a14';ctx.fillRect(ox+cc*gs,oy+r*gs,gs-1,gs-1)}
// Arrow
ctx.fillStyle='#4a475a';ctx.font='16px sans-serif';ctx.fillText('\u2192',ox+G*gs+6,oy+G*gs/2);
let fx=240;
K.forEach((kern,ki)=>{let fm=conv(grid,kern.k),pl=pool2(fm);
  ctx.fillStyle=`rgb(${kern.c})`;ctx.font='500 8px Fira Code';ctx.fillText(kern.n,fx,20);
  let mx=0;fm.forEach(r=>r.forEach(v=>{if(v>mx)mx=v}));if(!mx)mx=1;
  for(let r=0;r<14;r++)for(let cc=0;cc<14;cc++){ctx.fillStyle=`rgba(${kern.c},${fm[r][cc]/mx})`;ctx.fillRect(fx+cc*6,oy+r*6,5,5)}
  let py=oy+14*6+10;ctx.fillStyle='#4a475a';ctx.font='400 7px Fira Code';ctx.fillText('pool',fx,py-2);
  let pmx=0;pl.forEach(r=>r.forEach(v=>{if(v>pmx)pmx=v}));if(!pmx)pmx=1;
  for(let r=0;r<pl.length;r++)for(let cc=0;cc<pl[0].length;cc++){ctx.fillStyle=`rgba(${kern.c},${pl[r][cc]/pmx*.8})`;ctx.fillRect(fx+cc*9,py+r*9,8,8)}
  fx+=115});
// FC output
let energy=0;grid.forEach(r=>r.forEach(v=>energy+=v));
ctx.fillStyle='rgba(6,6,12,.9)';ctx.beginPath();ctx.roundRect(610,15,130,290,10);ctx.fill();ctx.strokeStyle='#1e1e32';ctx.lineWidth=1;ctx.beginPath();ctx.roundRect(610,15,130,290,10);ctx.stroke();
ctx.fillStyle='#ffd166';ctx.font='600 9px Fira Code';ctx.fillText('FC Output',622,34);
for(let i=0;i<10;i++){let v=energy<1?.05:Math.abs(Math.sin(energy*.08+i*1.9))*.6+.1;
  let bw=v*80;ctx.fillStyle=v>.55?'#4ecdc4':'rgba(78,205,196,.25)';ctx.fillRect(655,42+i*25,bw,18);
  ctx.fillStyle='#7d7a8c';ctx.font='500 10px Fira Code';ctx.textAlign='right';ctx.fillText(i+'',645,56+i*25);ctx.textAlign='left';
  if(v>.55){ctx.fillStyle='#fff';ctx.font='500 8px Fira Code';ctx.fillText((v*100|0)+'%',658+bw+3,56+i*25)}}}
function paint(e){let r=c.getBoundingClientRect(),mx=(e.clientX-r.left)*750/r.width,my=(e.clientY-r.top)*320/r.height;
let gx=Math.floor((mx-12)/gs),gy=Math.floor((my-28)/gs);
if(gx>=0&&gx<G&&gy>=0&&gy<G){grid[gy][gx]=Math.min(1,grid[gy][gx]+.4);
[[-1,0],[1,0],[0,-1],[0,1]].forEach(([dy,dx])=>{let ny=gy+dy,nx=gx+dx;if(ny>=0&&ny<G&&nx>=0&&nx<G)grid[ny][nx]=Math.min(1,grid[ny][nx]+.12)});draw()}}
c.onmousedown=e=>{drawing=true;paint(e)};c.onmousemove=e=>{if(drawing)paint(e)};c.onmouseup=()=>drawing=false;c.onmouseleave=()=>drawing=false;
const ctrl=addControls(el);const btn=document.createElement('button');btn.className='btn';btn.textContent='\ud83d\uddd1 Clear';btn.onclick=()=>{grid=Array(G).fill(0).map(()=>Array(G).fill(0));draw()};ctrl.appendChild(btn);draw()})();

// ============ LSTM: Animated gate visualization ============
(function(){
const el=$('demo-lstm'),[c,ctx]=createCanvas(el,750,340);
addHint(el,'Click "Next Word" to step through -- watch forget/input/output gates control information flow');
const sent=['The','quick','brown','fox','jumps','over','the','lazy','dog','today'];
let step=-1,cell=0,hidden=0,hist=[];
function advance(){step++;if(step>=sent.length){step=0;cell=0;hidden=0;hist=[]}
let w=sent[step],cv=0;for(let i=0;i<w.length;i++)cv+=w.charCodeAt(i);cv/=(w.length*128);
let fg=sigmoid(hidden*.5+cv*1.2-.3),ig=sigmoid(hidden*.3+cv*.9+.1),cand=Math.tanh(hidden*.4+cv*.7),og=sigmoid(hidden*.6+cv*.5);
cell=fg*cell+ig*cand;hidden=og*Math.tanh(cell);
hist.push({w:sent[step],fg,ig,og,cand,cell,hidden});draw()}
function draw(){ctx.clearRect(0,0,750,340);
let ox=25,oy=40,gap=Math.min(70,690/sent.length);
sent.forEach((w,i)=>{let x=ox+i*gap,done=i<=step,act=i===step;
if(i>0){ctx.strokeStyle=done?'rgba(78,205,196,.3)':'#151520';ctx.lineWidth=done?2:1;ctx.beginPath();ctx.moveTo(x-gap+25,oy);ctx.lineTo(x-5,oy);ctx.stroke()}
ctx.save();if(act){ctx.shadowColor='#4ecdc4';ctx.shadowBlur=12}
ctx.beginPath();ctx.roundRect(x-5,oy-16,Math.max(w.length*8+10,32),32,6);
ctx.fillStyle=act?'rgba(78,205,196,.15)':done?'rgba(78,205,196,.04)':'#0c0c16';ctx.fill();
ctx.strokeStyle=act?'#4ecdc4':done?'#4ecdc433':'#1e1e32';ctx.lineWidth=act?2:1;ctx.stroke();ctx.restore();
ctx.fillStyle=act?'#fff':done?'#4ecdc4':'#4a475a';ctx.font=`${act?'600 ':'400 '}11px Fira Code`;ctx.textAlign='center';ctx.fillText(w,x+Math.max(w.length*4,10),oy+4)});
if(hist.length>0){let cur=hist[hist.length-1],gy=85;ctx.textAlign='left';
[{n:'Forget Gate',v:cur.fg,c:'#ff6b6b',d:'How much old memory to retain'},
{n:'Input Gate',v:cur.ig,c:'#4ecdc4',d:'How much new info to write'},
{n:'Candidate',v:cur.cand,c:'#ffd166',d:'New candidate cell value'},
{n:'Output Gate',v:cur.og,c:'#a78bfa',d:'How much state to expose'}].forEach((g,i)=>{let y=gy+i*38;
ctx.fillStyle=g.c;ctx.font='600 10px Fira Code';ctx.fillText(g.n,20,y+12);
ctx.fillStyle='#4a475a';ctx.font='400 9px Fira Code';ctx.fillText(g.d,160,y+12);
ctx.fillStyle='#111120';ctx.fillRect(380,y,260,18);
ctx.fillStyle=g.c+'aa';ctx.fillRect(380,y,260*Math.abs(g.v),18);
ctx.fillStyle='#e4e2df';ctx.font='600 9px Fira Code';ctx.textAlign='right';ctx.fillText(g.v.toFixed(3),375,y+13);ctx.textAlign='left'});
let sy=gy+165;ctx.fillStyle='#ffd166';ctx.font='600 11px Fira Code';ctx.fillText(`Cell: ${cur.cell.toFixed(4)}`,20,sy);
ctx.fillStyle='#4ecdc4';ctx.fillText(`Hidden: ${cur.hidden.toFixed(4)}`,250,sy);
if(hist.length>1){let hy=sy+15,hh=50,hw=700;ctx.fillStyle='#0c0c16';ctx.fillRect(20,hy,hw,hh);
let mn=Math.min(...hist.map(h=>Math.min(h.cell,h.hidden))),mx=Math.max(...hist.map(h=>Math.max(h.cell,h.hidden)));if(mn===mx)mx=mn+1;
ctx.strokeStyle='#ffd166';ctx.lineWidth=2;ctx.beginPath();hist.forEach((h,i)=>{let x=20+i*(hw/sent.length),y=hy+hh-((h.cell-mn)/(mx-mn))*hh;i?ctx.lineTo(x,y):ctx.moveTo(x,y)});ctx.stroke();
ctx.strokeStyle='#4ecdc4';ctx.lineWidth=1.5;ctx.beginPath();hist.forEach((h,i)=>{let x=20+i*(hw/sent.length),y=hy+hh-((h.hidden-mn)/(mx-mn))*hh;i?ctx.lineTo(x,y):ctx.moveTo(x,y)});ctx.stroke();
ctx.fillStyle='#ffd166';ctx.font='400 8px Fira Code';ctx.fillText('cell',hw-20,hy+10);ctx.fillStyle='#4ecdc4';ctx.fillText('hidden',hw-20,hy+22)}}}
const ctrl=addControls(el);const btn=document.createElement('button');btn.className='btn';btn.textContent='\u25b6 Next Word';btn.onclick=advance;
let timer=null;const abtn=document.createElement('button');abtn.className='btn';abtn.textContent='\u23e9 Auto';abtn.onclick=()=>{if(timer){clearInterval(timer);timer=null;abtn.classList.remove('active');abtn.textContent='\u23e9 Auto'}else{timer=setInterval(advance,700);abtn.classList.add('active');abtn.textContent='\u23f9 Stop'}};
const rst=document.createElement('button');rst.className='btn';rst.textContent='\u21ba';rst.onclick=()=>{step=-1;cell=0;hidden=0;hist=[];ctx.clearRect(0,0,750,340);draw()};
ctrl.appendChild(btn);ctrl.appendChild(abtn);ctrl.appendChild(rst);draw()})();

// ============ SVM: Interactive with kernel switching + pixel regions ============
(function(){
const el=$('demo-svm'),[c,ctx]=createCanvas(el,750,360);
addHint(el,'Left-click = Class A, Right-click = Class B -- toggle Linear/RBF kernel to see nonlinear boundaries');
let pts=[],kernel='linear',margin=45,gamma=.0002;
for(let i=0;i<12;i++){pts.push({x:rand(40,280),y:rand(30,330),c:0});pts.push({x:rand(470,710),y:rand(30,330),c:1})}
for(let i=0;i<5;i++){pts.push({x:rand(300,450),y:rand(50,310),c:Math.random()>.5?1:0})}
let regionCanvas=document.createElement('canvas');regionCanvas.width=750/5;regionCanvas.height=360/5;let rctx=regionCanvas.getContext('2d');let dirty=true;
function updateRegions(){
let img=rctx.createImageData(150,72);
for(let y=0;y<72;y++)for(let x=0;x<150;x++){let rx=x*5,ry=y*5,i=(y*150+x)*4;
if(kernel==='linear'){let v=(rx-375)/375;i;if(v>0){img.data[i]=56;img.data[i+1]=189;img.data[i+2]=248;img.data[i+3]=18}else{img.data[i]=255;img.data[i+1]=100;img.data[i+2]=100;img.data[i+3]=18}}
else{let score=0;pts.forEach(p=>{let d=(rx-p.x)**2+(ry-p.y)**2;score+=(p.c?1:-1)*Math.exp(-d*gamma)});
if(score>0){img.data[i]=56;img.data[i+1]=189;img.data[i+2]=248;img.data[i+3]=clamp(Math.abs(score)*30,5,40)}
else{img.data[i]=255;img.data[i+1]=100;img.data[i+2]=100;img.data[i+3]=clamp(Math.abs(score)*30,5,40)}}}
rctx.putImageData(img,0,0);dirty=false}
function draw(){ctx.clearRect(0,0,750,360);if(dirty)updateRegions();ctx.imageSmoothingEnabled=true;ctx.drawImage(regionCanvas,0,0,750,360);
if(kernel==='linear'){let bx=375;
ctx.save();ctx.shadowColor='rgba(78,205,196,.4)';ctx.shadowBlur=10;
ctx.strokeStyle='#4ecdc4';ctx.lineWidth=2.5;ctx.beginPath();ctx.moveTo(bx,0);ctx.lineTo(bx,360);ctx.stroke();ctx.restore();
ctx.strokeStyle='#4ecdc433';ctx.lineWidth=1;ctx.setLineDash([5,5]);
ctx.beginPath();ctx.moveTo(bx-margin,0);ctx.lineTo(bx-margin,360);ctx.stroke();
ctx.beginPath();ctx.moveTo(bx+margin,0);ctx.lineTo(bx+margin,360);ctx.stroke();ctx.setLineDash([]);
ctx.fillStyle='rgba(78,205,196,.04)';ctx.fillRect(bx-margin,0,margin*2,360);
let svs=pts.filter(p=>Math.abs(p.x-bx)<margin+15);
svs.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,12,0,TAU);ctx.strokeStyle='#ffd166';ctx.lineWidth=2;ctx.stroke()});
ctx.fillStyle='#ffd16688';ctx.font='400 9px Fira Code';ctx.textAlign='center';ctx.fillText(`margin: ${margin*2}px`,bx,352);ctx.fillText(`${svs.length} support vectors`,bx,340)}
else{ctx.fillStyle='#a78bfa88';ctx.font='400 9px Fira Code';ctx.fillText('RBF Kernel: K(x,x\') = exp(-gamma ||x-x\'||^2)',10,18)}
pts.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,5.5,0,TAU);ctx.fillStyle=p.c?'#38bdf8':'#ff6b6b';ctx.fill();ctx.strokeStyle='rgba(6,6,12,.6)';ctx.lineWidth=1.2;ctx.stroke()});ctx.textAlign='left'}
c.onclick=e=>{const r=c.getBoundingClientRect();pts.push({x:(e.clientX-r.left)*750/r.width,y:(e.clientY-r.top)*360/r.height,c:0});dirty=true;draw()};
c.oncontextmenu=e=>{e.preventDefault();const r=c.getBoundingClientRect();pts.push({x:(e.clientX-r.left)*750/r.width,y:(e.clientY-r.top)*360/r.height,c:1});dirty=true;draw()};
const ctrl=addControls(el);ctrl.innerHTML='<label>Margin</label><input type="range" min="10" max="120" value="45" id="sm">';
$('sm').oninput=e=>{margin=+e.target.value;dirty=true;draw()};
const lb=document.createElement('button');lb.className='btn active';lb.textContent='Linear';lb.onclick=()=>{kernel='linear';lb.classList.add('active');rb.classList.remove('active');dirty=true;draw()};
const rb=document.createElement('button');rb.className='btn';rb.textContent='RBF Kernel';rb.onclick=()=>{kernel='rbf';rb.classList.add('active');lb.classList.remove('active');dirty=true;draw()};
ctrl.appendChild(lb);ctrl.appendChild(rb);updateRegions();draw()})();

// ============ GMM: Draggable EM with animated Gaussians ============
(function(){
const el=$('demo-gmm'),[c,ctx]=createCanvas(el,750,340);
addHint(el,'Drag cluster centers (big dots) -- click "EM Step" to watch the Gaussian mixture converge');
let data=[];for(let i=0;i<90;i++)data.push({x:rand(50,260)+rand(-35,35),y:rand(70,250)+rand(-35,35)});
for(let i=0;i<90;i++)data.push({x:rand(440,650)+rand(-35,35),y:rand(50,210)+rand(-35,35)});
for(let i=0;i<55;i++)data.push({x:rand(230,470)+rand(-45,45),y:rand(200,310)+rand(-35,35)});
let cls=[{x:150,y:160,sx:65,sy:65,c:'#ff6b6b',pi:.33},{x:540,y:130,sx:75,sy:55,c:'#38bdf8',pi:.33},{x:350,y:265,sx:60,sy:50,c:'#a78bfa',pi:.34}];
let asgn=data.map(()=>0),drag=-1,emN=0;
function gauss(x,y,mx,my,sx,sy){return Math.exp(-(((x-mx)/sx)**2+((y-my)/sy)**2)/2)}
function eStep(){asgn=data.map(d=>{let ps=cls.map((c,i)=>c.pi*gauss(d.x,d.y,c.x,c.y,c.sx,c.sy));let s=ps.reduce((a,b)=>a+b,.001);let mx=0;ps.forEach((p,i)=>{if(p>ps[mx])mx=i});return mx})}
function mStep(){cls.forEach((cl,ci)=>{let p=data.filter((_,i)=>asgn[i]===ci);if(!p.length)return;
cl.x=p.reduce((a,d)=>a+d.x,0)/p.length;cl.y=p.reduce((a,d)=>a+d.y,0)/p.length;
cl.sx=Math.sqrt(p.reduce((a,d)=>a+(d.x-cl.x)**2,0)/p.length)+10;cl.sy=Math.sqrt(p.reduce((a,d)=>a+(d.y-cl.y)**2,0)/p.length)+10;cl.pi=p.length/data.length})}
function em(){eStep();mStep();emN++;draw()}
function draw(){ctx.clearRect(0,0,750,340);
cls.forEach(cl=>{for(let r=3;r>=1;r--){ctx.beginPath();ctx.ellipse(cl.x,cl.y,cl.sx*r,cl.sy*r,0,0,TAU);
ctx.strokeStyle=cl.c+(r===1?'55':'18');ctx.lineWidth=r===1?2:1;ctx.stroke();
if(r===1){ctx.fillStyle=cl.c+'0a';ctx.fill()}}});
data.forEach((d,i)=>{ctx.beginPath();ctx.arc(d.x,d.y,2.5,0,TAU);ctx.fillStyle=cls[asgn[i]]?.c+'88'||'#555';ctx.fill()});
cls.forEach(cl=>{ctx.save();ctx.shadowColor=cl.c;ctx.shadowBlur=10;ctx.beginPath();ctx.arc(cl.x,cl.y,9,0,TAU);ctx.fillStyle=cl.c;ctx.fill();ctx.restore();
ctx.strokeStyle='#fff';ctx.lineWidth=2;ctx.beginPath();ctx.arc(cl.x,cl.y,9,0,TAU);ctx.stroke()});
ctx.fillStyle='#ffd166';ctx.font='600 11px Fira Code';ctx.fillText(`EM Steps: ${emN}`,10,20);ctx.fillStyle='#7d7a8c';ctx.fillText(`${data.length} points, 3 Gaussians`,140,20)}
c.onmousedown=e=>{const r=c.getBoundingClientRect();let mx=(e.clientX-r.left)*750/r.width,my=(e.clientY-r.top)*340/r.height;cls.forEach((cl,i)=>{if(dist(mx,my,cl.x,cl.y)<20)drag=i})};
c.onmousemove=e=>{if(drag>=0){const r=c.getBoundingClientRect();cls[drag].x=(e.clientX-r.left)*750/r.width;cls[drag].y=(e.clientY-r.top)*340/r.height;eStep();draw()}};
c.onmouseup=()=>drag=-1;
const ctrl=addControls(el);const btn=document.createElement('button');btn.className='btn';btn.textContent='\u25b6 EM Step';btn.onclick=em;
let timer=null;const abtn=document.createElement('button');abtn.className='btn';abtn.textContent='\u23e9 Auto EM';
abtn.onclick=()=>{if(timer){clearInterval(timer);timer=null;abtn.classList.remove('active')}else{timer=setInterval(em,180);abtn.classList.add('active')}};
ctrl.appendChild(btn);ctrl.appendChild(abtn);eStep();draw()})();

// ============ Random Forest: Animated tree growing ============
(function(){
const el=$('demo-rf'),[c,ctx]=createCanvas(el,750,300);
addHint(el,'Click "Grow Tree" to add decision trees -- watch the ensemble vote and confidence rise');
let trees=[],maxT=16;
function grow(){if(trees.length>=maxT)return;let v=Math.random()>.38?1:0;
trees.push({v,depth:randInt(3,7),conf:rand(.52,.96),features:randInt(2,5)});draw()}
function draw(){ctx.clearRect(0,0,750,300);let tw=42,g=3,ox=10,oy=28;
trees.forEach((t,i)=>{let x=ox+i*(tw+g);
ctx.beginPath();ctx.moveTo(x+tw/2,oy);ctx.lineTo(x+tw,oy+55);ctx.lineTo(x,oy+55);ctx.closePath();
ctx.fillStyle=t.v?'rgba(78,205,196,.12)':'rgba(255,107,107,.12)';ctx.fill();
ctx.strokeStyle=t.v?'#4ecdc4':'#ff6b6b';ctx.lineWidth=1.5;ctx.stroke();
ctx.fillStyle='#5a4a3a';ctx.fillRect(x+tw/2-3,oy+55,6,12);
ctx.fillStyle=t.v?'#4ecdc4':'#ff6b6b';ctx.font='bold 10px Fira Code';ctx.textAlign='center';ctx.fillText(t.v?'A':'B',x+tw/2,oy+48);
ctx.fillStyle='#7d7a8c';ctx.font='400 7px Fira Code';ctx.fillText((t.conf*100|0)+'%',x+tw/2,oy+78)});
if(trees.length>0){let ry=115,aV=trees.filter(t=>t.v===1).length,bV=trees.filter(t=>t.v===0).length,n=trees.length;
ctx.fillStyle='rgba(6,6,12,.88)';ctx.beginPath();ctx.roundRect(10,ry,730,175,12);ctx.fill();ctx.strokeStyle='#1e1e32';ctx.lineWidth=1;ctx.beginPath();ctx.roundRect(10,ry,730,175,12);ctx.stroke();
let bx=60,by=ry+25,bw=550,bh=35;ctx.fillStyle='#111120';ctx.beginPath();ctx.roundRect(bx,by,bw,bh,6);ctx.fill();
if(n>0){ctx.fillStyle='rgba(78,205,196,.45)';ctx.beginPath();ctx.roundRect(bx,by,bw*(aV/n),bh,6);ctx.fill();
ctx.fillStyle='rgba(255,107,107,.45)';let start=bx+bw*(aV/n);ctx.fillRect(start,by,bw*(bV/n),bh)}
ctx.fillStyle='#fff';ctx.font='700 13px Fira Code';ctx.textAlign='center';
if(aV>0)ctx.fillText(`A: ${aV}`,bx+bw*(aV/n)/2,by+22);if(bV>0)ctx.fillText(`B: ${bV}`,bx+bw*aV/n+bw*(bV/n)/2,by+22);
ctx.fillStyle='#ffd166';ctx.font='900 22px Fraunces';ctx.fillText(`\u2192 Class ${aV>=bV?'A':'B'}`,375,ry+100);
let conf=(Math.max(aV,bV)/n*100).toFixed(0);ctx.fillStyle='#7d7a8c';ctx.font='400 11px Fira Code';ctx.fillText(`${conf}% confidence  \u00b7  ${n} trees  \u00b7  majority voting`,375,ry+125);
// Accuracy bars
ctx.fillStyle='#4a475a';ctx.font='400 9px Fira Code';ctx.textAlign='left';
ctx.fillText(`Avg tree depth: ${(trees.reduce((a,t)=>a+t.depth,0)/n).toFixed(1)}`,30,ry+160);
ctx.fillText(`Avg tree confidence: ${(trees.reduce((a,t)=>a+t.conf,0)/n*100).toFixed(0)}%`,300,ry+160);
ctx.fillText(`Features sampled: sqrt(${trees[0]?.features||'?'})`,560,ry+160)}
ctx.textAlign='left';ctx.fillStyle='#ffd166';ctx.font='600 10px Fira Code';ctx.fillText(`Forest: ${trees.length}/${maxT}`,10,20)}
const ctrl=addControls(el);const btn=document.createElement('button');btn.className='btn';btn.textContent='\ud83c\udf32 Grow Tree';btn.onclick=grow;
let timer=null;const abtn=document.createElement('button');abtn.className='btn';abtn.textContent='\ud83c\udf33 Grow All';
abtn.onclick=()=>{if(timer)return;timer=setInterval(()=>{grow();if(trees.length>=maxT){clearInterval(timer);timer=null}},180)};
const rst=document.createElement('button');rst.className='btn';rst.textContent='\ud83d\uddd1 Clear';rst.onclick=()=>{trees=[];if(timer){clearInterval(timer);timer=null}draw()};
ctrl.appendChild(btn);ctrl.appendChild(abtn);ctrl.appendChild(rst);draw()})();

// ============ AdaBoost: Weighted sample visualization ============
(function(){
const el=$('demo-ada'),[c,ctx]=createCanvas(el,750,300);
addHint(el,'Click "Add Learner" -- watch misclassified points grow bigger (heavier weight) each round');
let pts=[];for(let i=0;i<14;i++){pts.push({x:rand(35,310),y:rand(25,270),c:0,w:1/28});pts.push({x:rand(440,715),y:rand(25,270),c:1,w:1/28})}
let stumps=[],rd=0;
function addStump(){let bx=375,be=Infinity;
for(let x=40;x<710;x+=8){let err=0;pts.forEach(p=>{if((p.x>x?1:0)!==p.c)err+=p.w});if(err<be){be=err;bx=x}}
let al=.5*Math.log((1-be+.001)/(be+.001));
pts.forEach(p=>{p.w*=Math.exp((p.x>bx?1:0)!==p.c?al:-al)});
let ws=pts.reduce((a,p)=>a+p.w,0);pts.forEach(p=>p.w/=ws);
stumps.push({x:bx,alpha:al});rd++;draw()}
function draw(){ctx.clearRect(0,0,750,300);
stumps.forEach((s,i)=>{ctx.strokeStyle=`rgba(255,209,102,${.12+i*.06})`;ctx.lineWidth=1.5;ctx.setLineDash([4,4]);ctx.beginPath();ctx.moveTo(s.x,0);ctx.lineTo(s.x,280);ctx.stroke();ctx.setLineDash([]);
ctx.fillStyle=`rgba(255,209,102,${.3+i*.05})`;ctx.font='400 8px Fira Code';ctx.textAlign='center';ctx.fillText(`h${i+1}`,s.x,290);ctx.fillText(`\u03b1=${s.alpha.toFixed(2)}`,s.x,280)});
pts.forEach(p=>{let r=clamp(3+p.w*200,3,28);ctx.beginPath();ctx.arc(p.x,p.y,r,0,TAU);
ctx.fillStyle=p.c?'rgba(56,189,248,.35)':'rgba(255,107,107,.35)';ctx.fill();
ctx.strokeStyle=p.c?'#38bdf8':'#ff6b6b';ctx.lineWidth=1;ctx.stroke()});
ctx.textAlign='left';ctx.fillStyle='#ffd166';ctx.font='600 11px Fira Code';ctx.fillText(`Round ${rd}: ${stumps.length} weak learners`,10,18);
ctx.fillStyle='#7d7a8c';ctx.font='400 9px Fira Code';ctx.fillText('H(x) = sign( \u03a3 \u03b1_t h_t(x) )  -- bigger circles = harder samples',10,292)}
const ctrl=addControls(el);const btn=document.createElement('button');btn.className='btn';btn.textContent='\u2795 Add Learner';btn.onclick=addStump;
let timer=null;const abtn=document.createElement('button');abtn.className='btn';abtn.textContent='\u23e9 Auto';
abtn.onclick=()=>{if(timer){clearInterval(timer);timer=null;abtn.classList.remove('active')}else{timer=setInterval(()=>{addStump();if(rd>=14){clearInterval(timer);timer=null;abtn.classList.remove('active')}},250);abtn.classList.add('active')}};
ctrl.appendChild(btn);ctrl.appendChild(abtn);draw()})();
</script></body></html>
